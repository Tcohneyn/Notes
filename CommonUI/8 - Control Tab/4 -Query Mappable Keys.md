## 🔍 查询可重映射键位信息

### 1. 🛠️ 初始化 C++ 结构

在 `initControlCollectionTab` 函数中，讲师首先构建了基础的分类结构：

- **创建分类：** 定义了 `KeyboardMouseCategoryCollection`，用于存放键盘和鼠标相关的设置。
- **层级关系：** 将该分类添加为 `ControlTabCollection` 的子项。
- **参数修改：** 修改了函数签名，引入 `ULocalPlayer` 指针，以便在代码中访问子系统。

------

### 2. 🛰️ 获取 Enhanced Input 子系统

通过 `ULocalPlayer` 获取处理输入的核心组件：

- **Enhanced Input Local Player Subsystem：** 这是管理运行时输入映射的核心。
- **Enhanced Input User Settings：** 从子系统中获取用户设置对象，它是存储和检索可重映射键位的入口。
- **有效性检查：** 使用宏确保子系统和用户设置对象在继续执行前均有效。

------

### 3. 🔄 遍历 Mappable Keys 的三层循环

为了提取具体数据，需要逐层深入 Enhanced Input 的数据结构：

| **循环层级** | **获取对象**               | **说明**                                                     |
| ------------ | -------------------------- | ------------------------------------------------------------ |
| **第一层**   | `PlayerMappableKeyProfile` | 遍历所有保存的键位配置文件（Profile）。通常情况下只有一个默认配置。 |
| **第二层**   | `KeyMappingRow`            | 从配置文件中获取“映射行”。每一行对应一个输入动作（Input Action），其 Key 是 ID（FName）。 |
| **第三层**   | `PlayerKeyMapping`         | 遍历每个动作下绑定的所有物理按键。例如，“开火”动作可能同时绑定了“鼠标左键”和“手柄触发器”。 |

------

### 4. 📝 提取与调试打印数据

在最内层循环中，讲师提取了每个映射的关键属性，并通过调试工具打印到屏幕和输出日志（Output Log）中：

- **Mapping ID：** 输入动作的内部唯一标识（如 `ID_Melee`）。
- **Display Name：** 在 UI 上显示的名称（如 `Melee`）。
- **Current Key：** 当前绑定的物理按键名称（如 `Q` 或 `Gamepad Face Button Left`）。

------

### 5. ✅ 实验结果

- **控制台输出：** 成功列出了所有在上一讲中定义的输入动作。
- **数据验证：** 每个动作都正确显示了两个绑定的按键（一个键盘键，一个手柄键）。
- **待解决问题：** 目前所有类型的按键（键盘和手柄）都混在一起显示。下一讲将研究如何**过滤（Filter）**按键类型，以便在“键盘/鼠标”分类中只显示相关的按键。

**结论：** 成功实现了从 C++ 后端检索 Enhanced Input 系统中所有可重映射数据的逻辑。