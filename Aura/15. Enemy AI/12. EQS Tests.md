这段视频教程深入讲解了如何在环境查询系统（EQS）中添加**Trace（射线检测）测试**，并创建**自定义查询上下文（Query Context）**，以过滤出 AI 能够直接看到玩家的采样点。

以下是内容的详细总结：

------

### 一、 Trace 测试基础

- **添加测试**：在生成器（Generator）上右键选择 `Add Test` -> `Trace`。
- **测试目的（Test Purpose）**：
  - **Filter Only**：仅过滤点（合格或不合格）。
  - **Score Only**：仅给点评分。
  - **Filter and Score**：既过滤又评分。
- **逻辑原理**：Trace 测试通过从采样点向指定目标（上下文）发射射线，检查路径是否被阻挡。

### 二、 创建自定义查询上下文 (`EQC_PlayerContext`)

默认的上下文通常是查询者（AI 自己），但我们需要 AI 追踪玩家（Aura）。

1. **创建蓝图**：新建 `EnvQueryContext_BlueprintBase` 类的蓝图，命名为 `EQC_PlayerContext`。
2. **重写函数**：重写 **`Provide Actor Set`**（提供演员集合）。
3. **获取玩家**：在函数内使用 `Get All Actors of Class`，选择 `BP_AuraCharacter`。
4. **应用上下文**：在 EQS 编辑器的 Trace 测试属性中，将 **Context** 设置为新创建的 `EQC_PlayerContext`。

### 三、 过滤逻辑与可视化调试

- **布尔匹配（Bool Match）**：
  - 设置为 `True`：保留那些**能**射中（看到）玩家的点。
  - 设置为 `False`：保留那些**不能**射中玩家的点。
- **障碍物测试**：在场景中放置静态网格体（如墙壁）。
  - AI 会自动识别出哪些采样点被墙壁遮挡（显示为红色或被过滤掉），哪些点能看到玩家（显示为蓝色）。

### 四、 解决“几何体内部点”问题

- **问题描述**：有时采样点会生成在实心物体内部，由于背面剔除等原因，这些点可能误判为能看到玩家。
- **解决方案：导航网格（Nav Mesh）**：
  - 引入 **Nav Mesh Bounds Volume** 并按 `P` 键确认绿色的导航区域。
  - **Pathing Grid（寻路网格）**生成器的特性：它只会在可导航的表面（Nav Mesh）上生成点。
  - **效果**：一旦有了导航网格，生成器会自动避开实心物体内部和无法行走的区域，从而保证采样点的实用性。

### 五、 核心总结与下一步

- **当前进展**：我们已经能生成点，并剔除了看不到玩家的点。
- **下一步预告**：现在剩下的点都是“合格”的，但我们需要从这些合格点中选出“最好的”一个（例如距离玩家最远或最近的点），这需要通过**评分（Scoring）**机制来实现。

------

**您是否需要我为您解释“过滤（Filtering）”和“评分（Scoring）”在实际战斗逻辑中如何配合，或者想了解如何为 Trace 测试设置特定的碰撞频道（Collision Channel）？**