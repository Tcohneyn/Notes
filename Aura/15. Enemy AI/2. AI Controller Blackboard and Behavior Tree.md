这份视频字幕详细介绍了如何在虚幻引擎中通过 **C++ 和蓝图联合开发**，为敌人配置 AI 控制器（AI Controller）并启动行为树（Behavior Tree）系统。

以下是内容的详细标题大纲式总结：

------

### 一、 创建自定义 AI 控制器 (OraAIController)

- **创建目的**：为了超越默认 AI 控制器的限制，添加特定的行为树（Behavior Tree）和黑板（Blackboard）组件。
- **C++ 类构建**：
  - 在新的 `AI` 文件夹下创建继承自 `AAIController` 的 `AuraAIController` 类。
  - **模块依赖更新**：在 `Aura.Build.cs` 中添加 `AIModule` 模块，否则无法使用 AI 相关类。

### 二、 组件定义与构造逻辑

- **组件声明**：
  - 在控制器中声明 `UBlackboardComponent` 和 `UBehaviorTreeComponent`。
  - 使用 `TObjectPtr` 进行指针管理，并进行前向声明以优化编译。
- **构造函数实现**：
  - 使用 `CreateDefaultSubobject` 初始化组件。
  - **优化细节**：发现基类 `AAIController` 已经内置了 `Blackboard` 变量，因此直接对内置变量进行赋值和检查，避免重复定义。

### 三、 敌人基类 (AuraEnemy) 的扩展

- **关键变量添加**：
  - 添加 `UBehaviorTree` 资产指针（暴露给蓝图编辑，方便不同敌人切换 AI 逻辑）。
  - 添加指向自定义 `AOraAIController` 的指针。
- **PossessedBy 函数重写**：
  - 重写 `PossessedBy` 函数，这是敌人被 AI 控制器接管的起始点。
  - 在函数内部执行 **Cast（类型转换）**，将通用的控制器转换为 `AOraAIController` 并保存引用。

### 四、 蓝图资源与配置

- **资源创建**：
  - 创建 **AI 控制器蓝图** (`BP_AuraAIController`)。
  - 创建 **黑板 (Blackboard)** 资源：用于存储 AI 记忆和变量。
  - 创建 **行为树 (Behavior Tree)** 资源：用于编写 AI 逻辑流。
- **敌人蓝图设置**：
  - 在 `BP_EnemyBase` 中将 `AI Controller Class` 设置为自定义的 `BP_AuraAIController`。
  - 将新创建的行为树资产分配给敌人基类的变量。

### 五、 启动 AI 行为树 (核心逻辑)

- **服务器端运行限制**：通过 `HasAuthority()` 确保 AI 逻辑仅在服务器（Server）上运行。
- **逻辑初始化步骤**：
  1. **初始化黑板**：通过控制器调用 `InitializeBlackboard`，并传入行为树关联的黑板数据。
  2. **运行行为树**：调用 `RunBehaviorTree` 正式开启 AI 逻辑循环。

### 六、 功能验证与测试

- **简单任务测试**：
  - 在行为树根节点添加 `Selector`。
  - 添加一个 `Play Animation` 任务，设置敌人播放“矛攻击”动画。
- **结果确认**：
  - 运行游戏后，场景中的敌人自动开始播放指定动画。
  - 通过行为树编辑器的实时视图（Visual Debugger），可以观察到控制流在节点间正确流转。

------

**下一步建议**：现在 AI 的“大脑”框架已经搭好，你可以开始在行为树中添加更复杂的逻辑，比如检测玩家位置、追踪和自动切换攻击状态。