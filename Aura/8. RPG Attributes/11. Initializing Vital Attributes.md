# 初始化生命值与法力值的正确方式

## 1. 问题背景

- 之前用硬编码方式初始化 Health 和 Mana，不合理。
- Max Health 与 Max Mana 依赖其他属性：
  - Max Health ← Vigor + 玩家等级
  - Max Mana ← Intelligence + 玩家等级
- 因此不能直接在构造函数里硬编码设置。

## 2. 正确做法

- **使用 Gameplay Effect 初始化**
  - Health 设置为 Max Health。
  - Mana 设置为 Max Mana。
- 该效果只需是 **瞬时 (Instant) Gameplay Effect**，作用是初始化，而非持续生效。
- 必须在 Max Health、Max Mana 初始化之后执行，确保数值正确。

## 3. 实现步骤

1. **添加新变量**
   - 在 `AuraCharacterBase` 中新增 `DefaultVitalAttributes`（Gameplay Effect Class）。
   - 与已有的 `DefaultPrimaryAttributes`、`DefaultSecondaryAttributes` 并列。
2. **应用 Gameplay Effect**
   - 按顺序应用：
     1. Primary Attributes
     2. Secondary Attributes（包含 Max Health / Max Mana）
     3. Vital Attributes（初始化 Health / Mana）。
   - 调用 `ApplyEffectToSelf(DefaultVitalAttributes, 1)`。
3. **创建 Gameplay Effect**
   - 蓝图路径：Blueprints → AbilitySystem → GameplayEffects → DefaultAttributes。
   - 新建 **GameplayEffect**：`GE_AuraVitalAttributes`。
   - 配置为 **Instant**。
   - 添加两个 Modifier：
     - Health = Max Health（Override，Attribute Based，Target 来源）。
     - Mana = Max Mana（Override，Attribute Based，Target 来源）。
4. **角色蓝图设置**
   - 在 `BP_AuraCharacter` → Attributes → `DefaultVitalAttributes` 中指定 `GE_AuraVitalAttributes`。
   - 保存并运行游戏。

## 4. 验证效果

- 游戏开始时，Health 和 Mana 的 Globe 会显示为满值。
- Debug 显示略有限制，但通过 UI 数值绑定可以验证。

## 5. 知识总结

- **Modifier Magnitude 类型**：
  - Scalable Float
  - Attribute Based
  - Custom Calculation Class
  - Set By Caller（尚未学习）。
- 至此已掌握三种常用类型，能处理大多数初始化与计算需求。
- 强调 GAS 的灵活性和强大功能。

