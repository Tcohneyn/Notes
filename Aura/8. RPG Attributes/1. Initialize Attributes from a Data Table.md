# **用数据表初始化属性的方法**

## 1. 视频目标

- 学习另一种初始化属性的方式：**通过数据表（Data Table）**。
- 对比不同方法：
  - 目前做法：直接调用 init 函数（不推荐）。
  - 教师偏好：通过 **Gameplay Effect** 初始化（更常用）。
  - 本视频内容：演示数据表初始化（备用方案）。

------

## 2. 新增属性准备

- 打开 **AuraAttributeSet.h**，添加更多属性：
  - 分类：Vital Attributes → Primary Attributes（RPG 常见属性）。
  - 新增 4 个 **Primary Attributes**：
    1. Strength（力量）
    2. Intelligence（智力）
    3. Resilience（韧性）
    4. Vigor（体力）

------

## 3. 属性定义步骤

### 3.1 Strength（力量）示例

- 新建 `FGameplayAttributeData Strength`。
- 添加 `UPROPERTY`（Category=Primary Attributes，ReplicatedUsing=OnRep_Strength）。
- 使用 **ATTRIBUTE_ACCESSORS 宏**生成访问器。
- 添加 RepNotify：`OnRep_Strength(OldStrength)`。
- 在 `.cpp` 中实现：
  - 使用 `GAMEPLAYATTRIBUTE_REPNOTIFY` 宏。
- 在 `GetLifetimeReplicatedProps` 中注册。

### 3.2 扩展到其他属性

- 使用复制替换方式快速生成 Intelligence、Resilience、Vigor。
- 每个属性都需：
  - 定义变量。
  - 宏访问器。
  - RepNotify。
  - 注册到 `GetLifetimeReplicatedProps`。

------

## 4. 暴露 Ability System Component

- 打开 **AuraPlayerState**。
- 将 `AbilitySystemComponent` 的 `UPROPERTY` 改为 `VisibleAnywhere`。
- 作用：可以在 **Blueprint Details 面板**中看到并设置其属性。

------

## 5. 使用数据表初始化属性

### 5.1 Default Starting Data

- 在 **ASC Details 面板**中找到 `Default Starting Data` 数组。
- 添加元素，包含：
  - Attribute Set 类型（AuraAttributeSet）。
  - Default Starting Table（选择数据表）。

### 5.2 创建数据表

- 新建文件夹：Blueprints/AbilitySystem/Data。
- 创建 Data Table（Row Structure = **AttributeMetaData**）。
- 命名：`DBT_InitialPrimaryValues`。

### 5.3 填充数据表行

- RowName 格式：`AttributeSetName.AttributeName`。
  - `AuraAttributeSet.Strength` → BaseValue = 10。
  - `AuraAttributeSet.Intelligence` → BaseValue = 17。
  - `AuraAttributeSet.Resilience` → BaseValue = 11。
  - `AuraAttributeSet.Vigor` → BaseValue = 9。
- 保存并回到 PlayerState，绑定数据表。

------

## 6. 测试结果

- 编译运行 → `ShowDebug`。
- 输出显示：
  - 新增四个 Primary Attributes（已初始化为设定值）。
  - Strength = 10，Intelligence = 17，Resilience = 11，Vigor = 9。

------

## 7. 数据表结构说明

- Data Table Row 包含：
  - BaseValue（基础值）
  - MinValue / MaxValue（尚未生效，不会强制限制）
  - Derived Attribute Info（未完全实现）
  - CanStack（布尔值）
- 实际功能：**只负责初始化值**，不提供限制或动态逻辑。

------

## 8. 方法评价

- **优点**：
  - 简单直观，只需编辑数据表即可批量初始化。
- **缺点**：
  - 仅能初始化，不能处理最小/最大值逻辑。
  - 功能有限（WIP）。
- **推荐做法**：
  - 最终还是通过 **Gameplay Effect** 在游戏开始时设置所有属性。

------

## 9. 总结

- 本视频展示了另一种初始化属性的方法（数据表）。
- 实际项目中，建议优先使用 **Gameplay Effect**。
- 数据表方法适合快速配置与演示。

