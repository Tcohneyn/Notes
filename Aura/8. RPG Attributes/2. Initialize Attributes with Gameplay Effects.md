# **使用 Gameplay Effect 初始化角色属性**

## 1. 回顾与目标

- 之前用 **Data Table** 初始化属性（非首选方式）。
- 现在改用 **Gameplay Effect (GE)** 初始化角色的 Primary Attributes。
- 在 AuraCharacter 中通过函数调用应用 GE 来设置初始值。

------

## 2. 移除 Data Table 初始化

- 打开编辑器 → PlayerState → AbilitySystemComponent。
- 移除默认 Starting Data 中的 Data Table。
- 运行 → Debug 查看，所有属性值为 0，不再重复显示。

------

## 3. 在 Character 类中准备 Gameplay Effect 初始化

### 新增变量

- 在 `AuraCharacterBase` 中添加：
  - `DefaultPrimaryAttributes`（GameplayEffect 子类）。
  - Blueprint 可编辑（EditAnywhere, BlueprintReadOnly）。
  - 分类归为 Attributes。

### 新增函数

- `InitializePrimaryAttributes()`：
  - 生成 GE Spec 并应用到目标（自己）。
  - 使用 `MakeEffectContext` 创建 Context Handle。
  - 使用 `MakeOutgoingSpec` 创建 Spec Handle。
  - 使用 `ApplyGameplayEffectSpecToTarget` 应用效果。
  - 注意：需要解引用 `SpecHandle.Data.Get()` 获取实际 Spec。
  - 添加 `check()` 确保 **ASC 有效** 且 **GE 类不为空**。
  - 函数设为 `const`。

------

## 4. 在 AuraCharacter 中调用初始化函数

- 在 `InitAbilityActorInfo()` 中调用 `InitializePrimaryAttributes()`。
- 应该在 **服务器端**调用（属性可复制到客户端）。
- 如果在客户端也调用 → 可以减少等待复制的延迟。

------

## 5. 创建 Gameplay Effect：GAuraPrimaryAttributes

- 目录结构：
  - `AbilitySystem/GameplayEffects/PrimaryAttributes/GAuraPrimaryAttributes`。
- 配置：
  - **Instant 类型**（只应用一次）。
  - **四个 Modifiers**：
    - Strength → Override → 值 10
    - Intelligence → Override → 值 17
    - Resilience → Override → 值 12
    - Vigor → Override → 值 9

------

## 6. 在 Blueprint 中设置默认 GE

- 打开 `BP_AuraCharacter`。
- 将 `DefaultPrimaryAttributes` 设置为 `GAuraPrimaryAttributes`。

------

## 7. 测试与验证

- 运行并 Debug → 属性显示：
  - Strength = 10
  - Intelligence = 17
  - Resilience = 12
  - Vigor = 9
- 成功通过 Gameplay Effect 初始化属性。

------

## 8. 总结

- **三种初始化属性方式**：
  1. AttributeSet 内部初始化（如 Health、Mana）。
  2. Data Table（不推荐）。
  3. Gameplay Effect（推荐 & 常用）。
- 使用 GE 的优势：
  - 灵活、可扩展。
  - 方便后续加载存档数据或动态修改初始值。