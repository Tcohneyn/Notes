# **UE5 GAS - 自定义计算（Modifier Magnitude Calculation, MMC）与接口设计**

## 1. 背景与问题

- 已掌握：属性之间相互依赖（attribute backed by other attributes）。
- 限制：修饰符（modifier）和参数设置虽灵活，但遇到复杂计算会受限。
- 需求：需要更复杂的计算方式 → 引入自定义计算（Custom Calculations / MMC）。

------

## 2. 使用场景示例

- 目标：修改 **Max Health（最大生命值）**。
- Infinite Gameplay Effect 中设置为 Override。
- 想要 Max Health 依赖多个来源：
  1. **基础值**：80。
  2. **属性加成**：Vigor × 系数。
  3. **额外变量**：玩家等级（Level）× 系数。
- 问题：
  - Vigor 在 Attribute Set 中，可直接用。
  - Level 不是 Attribute，而是变量（可能存在 PlayerState）。
  - 需要一种能结合属性与外部变量的计算方法。

------

## 3. MMC（Modifier Magnitude Calculation, 自定义计算类）

- 定义：一个 C++ 类，负责定义修饰符最终的计算方式。
- 用法：
  - 将复杂公式逻辑封装进 MMC。
  - 将 MMC 应用到 Modifier 上。
  - 可以实现任意复杂的计算。
- 优点：灵活，不局限于 Attribute Set 内的属性。

------

## 4. Level 的设计选择

- 可行性：Level 也可以放进 Attribute Set。
- 决策：不把 Level 作为 Attribute，而是 PlayerState 的变量。
- 理由：
  - Level 更像 **进度计数器**，不是和其他属性复杂互动的数值。
  - Level 通常为整数，而 Attribute 多为浮点数。
  - 逻辑上：Level 代表成长进度，非 GAS 属性系统核心数值。

------

## 5. 抽象化与接口（Interface）的引入

- 问题：MMC 需要访问 Source / Target 信息，但不应依赖具体类（PlayerState / Character）。
- 解决方案：
  - 引入 **Combat Interface（战斗接口）**。
  - Combat Interface 提供获取 Level 的方法。
  - 任何实现了 Combat Interface 的类（PlayerState、角色、敌人等）都能提供 Level。
- 优点：
  - 代码解耦，避免硬绑定到 AuraCharacter 或 AuraPlayerState。
  - 符合 **Clean Code / Best Practice**，扩展性更高。

------

## 6. 实现步骤

1. **PlayerState 添加 Level 变量**（存放等级数值）。
2. **创建 Combat Interface**，可被任何战斗相关类实现。
   - 包含一个函数：`GetPlayerLevel()`。
3. **编写 MMC**（Modifier Magnitude Calculation）：
   - Max Health MMC：依赖 Vigor 与 Level。
   - Max Mana MMC：依赖 Intelligence 与 Level。
4. **最终效果**：
   - Max Health = 基础值 + Vigor × 系数 + Level × 系数。
   - Max Mana = 基础值 + Intelligence × 系数 + Level × 系数。

------

## 7. 后续工作

- 在接下来的视频里，将实现：
  - PlayerState 等级变量。
  - Combat Interface。
  - Max Health 与 Max Mana 的 MMC。
- 完成后，再进入 **属性菜单（Attribute Menu）** 的制作。

------

