## 总结（Gameplay Effect Stacking）

### 1. 无叠加（Stacking = None）

- 拾取多个 Mana Crystal 时，效果会**重复应用多次**，每个都有独立的持续时间。
- 结果：目标在同一时间段内会获得数倍的数值提升，看起来像叠加，但其实只是**并行存在的多个效果**。

------

### 2. 叠加类型

- **Aggregate by Source（按来源聚合）**
  - 堆叠上限（Stack Limit Count）是 **每个来源单独计算**。
  - 同一个来源能叠到上限（比如 2 层），但不同来源还能再额外叠加。
  - 举例：敌人 A 给了目标 2 层，敌人 B 还能给目标再加 2 层。
- **Aggregate by Target（按目标聚合）**
  - 堆叠上限是 **目标整体计算**。
  - 一旦目标身上的总层数达到上限（比如 2 层），无论哪个来源都无法再叠加。

------

### 3. 叠加相关策略

- **Stack Duration Refresh Policy（持续时间刷新策略）**
  - **Refresh on Successful Application**：新层数叠加时刷新持续时间。
  - **Never Refresh**：不管叠多少层，原来的持续时间到了就结束。
- **Stack Period Reset Policy（周期刷新策略）**
  - 控制周期性效果（Periodic）在叠加时是否重置周期计时。
- **Stack Expiration Policy（过期策略）**
  - **Clear Entire Stack**：持续时间结束时，整组叠加全部清除。
  - **Remove Single Stack and Refresh Duration**：持续时间结束时只移除一层，并刷新剩余层数的持续时间。
  - **Refresh Duration**：效果会一直刷新自身的持续时间 → 相当于**无限持续**（需手动管理层数）。

------

### 4. 示例：Mana Crystal

- 参数设置：
  - Duration = 1s
  - Period = 0.1s
  - 每 0.1s 回复 1 点 Mana（1 秒总共 +10）。
- 测试效果：
  - 多个水晶拾取时，可以通过叠加配置决定是叠层、刷新持续时间，还是直接并行应用。
  - 不同配置下，Mana 回复的表现差异很大。

------

### 5. 应用到 Crystal Heal

- 与 Crystal Mana 一样，设置为：
  - **Aggregate by Target**，Stack Limit = 1
  - **Refresh on Successful Application**
  - **Reset on Successful Application**
  - **Clear Entire Stack**
- 好处：避免同类水晶被一次性拾取时回复量过于夸张。

------

✅ **结论**：

- Stacking 提供了灵活的控制方式，用于决定多个相同 Gameplay Effect 同时存在时的行为。
- 不同策略适合不同玩法需求（比如持续回复 vs. 防止滥用）。

