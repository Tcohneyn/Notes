## 总结（Infinite Effect 的应用与移除）

### 1. Infinite Effect 的特点

- 需要在 EndOverlap 时手动移除。
- 根据 **Removal Policy** 决定是否移除。

------

### 2. 句柄（Handle）的作用

- `ApplyGameplayEffectSpecToSelf` 返回 **FActiveGameplayEffectHandle**。
- 必须保存该 Handle，才能在之后移除效果。

------

### 3. 多 Actor 重叠问题

- 如果只保存一个 Handle，会被覆盖。
- 需要记录 **Actor/ASC 与 Handle 的对应关系**。

------

### 4. Map 解决方案

- 使用 `TMap<FActiveGameplayEffectHandle, UAbilitySystemComponent*>`。
- Key → GameplayEffect Handle。
- Value → 目标的 AbilitySystemComponent。

------

### 5. 判断是否 Infinite Effect

- 从 **EffectSpecHandle → Data → Def → DurationPolicy** 获取时长策略。
- 若为 Infinite，则进入特殊处理逻辑。

------

### 6. 应用时逻辑

- 如果是 Infinite 且 Removal Policy = `RemoveOnEndOverlap` → 存入 Map。
- 其他情况无需保存。

------

### 7. EndOverlap 时逻辑

- 获取离开的 Actor 的 ASC。
- 遍历 Map，查找对应 ASC 的 Handle。
- 调用 `RemoveActiveGameplayEffect(handle)` 移除效果。
- 将移除后的 Handle 从 Map 中清理。

------

### 8. 蓝图调用设置

- Instant / Duration → 设置为 `DoNotApply`。
- Infinite → 设置为 `ApplyOnOverlap`。
- Removal Policy → 设置为 `RemoveOnEndOverlap`。
- 通过 **OnOverlap / OnEndOverlap BlueprintCallable** 调用，而不是直接调用 ApplyEffectToTarget。

------

### 9. 效果总结

- 进入重叠时 → 施加 Infinite Effect。
- 离开重叠时 → 自动移除该 Infinite Effect。

