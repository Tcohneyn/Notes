# 使用 Gameplay Tags 处理效果应用回调

## 1. 问题与目标

- **现状**：Debug Message 可以输出效果应用，但仅限开发调试。
- **目标**：在 HUD 上显示信息，或触发更有趣的逻辑。
- **依赖关系**：
  - AbilitySystemComponent 不知道 WidgetController。
  - WidgetController 负责向 HUD 广播数据。
  - 因此需要 **委托 (Delegate)** 从 ASC → WidgetController → HUD 传递信息。

------

## 2. 委托广播内容

- **思考**：委托需要传递什么信息？
- **解决方案**：使用 **Gameplay Tags** 作为标识。
- **流程**：
  1. 效果应用 → 检查是否携带 Gameplay Tags。
  2. 如果有 → 委托广播 Tags 给 WidgetController。
  3. WidgetController 再传递到 HUD。

------

## 3. 获取 Gameplay Tags

- **入口**：从 GameplayEffectSpec 获取。
- **可用函数**：
  - GetAllAssetTags()
  - GetAllGrantedTags()
- **区别**：
  - Asset Tags：携带在效果上，不会授予角色。
  - Granted Tags：只在持续性效果中生效。
- **本次使用**：`GetAllAssetTags()`。

------

## 4. Gameplay Tag Container

- **存储方式**：Gameplay Tags 存在 **FGameplayTagContainer** 中，而非数组。
- **原因**：更高效、专为 Tag 优化。
- **用法**：
  - 声明 `FGameplayTagContainer TagContainer;`
  - 调用 `EffectSpec.GetAllAssetTags(TagContainer);`
  - 循环遍历 `for (const FGameplayTag& Tag : TagContainer)`。

------

## 5. Debug 验证

- **打印标签**：
  - 使用 `GEngine->AddOnScreenDebugMessage(...)`。
  - 设置显示时间、颜色（如蓝色）、消息内容。
  - 消息中格式化输出 Tag 名称（`Tag.ToString()`）。
- **测试效果**：
  - 在 Crystal Heal 添加 **Health Tag**。
  - 在 Potion Heal 添加 **Health Tag**。
  - 在 Potion Mana 添加 **Mana Tag**。
  - 运行游戏 → 拾取物品 → 屏幕上打印对应标签信息。

------

## 6. 多标签处理

- **支持多标签**：如果一个效果有多个 Asset Tags，会逐个循环处理。
- **示例**：
  - Potion Mana 添加 **Mana** 和 **MaxMana** 两个标签。
  - 拾取后打印两条信息，证明循环有效。
- **应用拓展**：
  - 可用于触发不同消息、显示不同 Widgets、执行任意逻辑。

------

## 7. 下一步计划

- 把 **Gameplay Tag 委托广播给 WidgetController**。
- 逐步替代 Debug Message，实现 HUD 展示。
- 提交并保存代码，进入下个阶段。

