# UE5 Ghost Globe 制作完整教程总结

## 1. 教程目标

- 创建 **Ghost Globe**，作为 Health/Mana 进度球的“影子球”。
- 功能：
  - 平滑跟随主进度球变化（延迟效果）。
  - 可复用现有材质和材质实例。
  - 适用于不同类型进度球（Health、Mana）。

------

## 2. 概念与原理

- **Ghost Globe** 是主进度球的副本，视觉效果为延迟跟随。
- 核心原理：
  - 通过 **插值（Lerp/FInterp）** 平滑过渡。
  - **Delay** 可控制延迟时间。
  - 更新材质实例参数实现动态进度显示。
- Ghost Globe 与主 Globe 分离管理，但共享材质。

------

## 3. UI Blueprint 准备

- 打开 `WP Globe Progressbar` 基类。
- 检查现有材质：
  - `Ghost Health Globe`
  - `Ghost Mana Globe`
- 材质关键参数：
  - `Progress` 控制填充量。
  - 可通过 **动态材质实例（Dynamic Material Instance）** 在运行时修改。

------

## 4. 添加 Ghost Globe Progress Bar

- 在 Widget 中添加一个新的 **Progress Bar**：
  - 名称：`ProgressBar_Ghost`
  - 对齐：Horizontal & Vertical fill
  - 背景透明：Alpha = 0
  - Fill Style：使用 Ghost 材质
- 放置在主球后方，调整 **透明度** 区分主球与 Ghost。

------

## 5. Ghost Globe 变量设置

- **GhostPercentTarget**（float）：目标百分比
- **GhostDelay**（float）：延迟时间（默认 0.5 秒）
- **GhostInterpSpeed**（float）：插值速度（默认 1）
- 将变量归类到 **Ghost Globe Properties**。

------

## 6. 自定义事件与逻辑

- **GlobePercentSet** 事件：
  - 输入：Percent（float）
  - 功能：延迟设置 `GhostPercentTarget`
  - 使用 **Delay** 节点实现延迟效果。
- **SetGhostProgressBarPercent(float Percent)**：
  - 功能：直接设置 Ghost Progress Bar 百分比。

------

## 7. 更新材质与 Brush

- 新增变量：`GhostProgressBarBrush`（Slate Brush）
- 创建函数 `UpdateGhostGlobeBrush`：
  - 作用：更新 Ghost Progress Bar 的材质/样式
  - 可切换不同类型 Ghost 材质
- Brush 设置：
  - Tint Alpha 控制透明度
  - Fill Method：Vertical / Horizontal

------

## 8. 插值逻辑（平滑延迟效果）

- 在 **Event Tick** 中调用：

  - 使用 **FInterpTo** 对 Ghost Percent 插值：

    ```
    GhostCurrentPercent = FInterpTo(GhostCurrentPercent, GhostPercentTarget, DeltaTime, GhostInterpSpeed)
    ```

- 插值参数：

  - **Current**：当前 Ghost Progress Bar 百分比
  - **Target**：`GhostPercentTarget`
  - **DeltaTime**：Tick Delta
  - **InterpSpeed**：GhostInterpSpeed

- 确保 **子类调用父类 Tick**（Health / Mana Widget）。

------

## 9. 测试与调整

- 运行 UI，观察 Ghost Globe 行为：
  - 是否延迟跟随主进度球。
  - 插值是否平滑。
- 调整：
  - **GhostDelay** 控制延迟效果。
  - **GhostInterpSpeed** 控制平滑程度。
  - **Alpha** 控制视觉叠加效果。
- 注意材质 Tint 可能影响透明显示。

------

## 10. 最佳实践与扩展

- **材质复用**：
  - 使用 Dynamic Material Instance，允许不同类型球共用同一材质模板。
- **参数可调性**：
  - GhostDelay、InterpSpeed 和透明度应暴露给 UI Designer 调整。
- **复用逻辑**：
  - 将 Ghost Globe 插值逻辑封装为函数，方便在不同 Widget 复用。
- **性能优化**：
  - 避免每帧生成材质实例。
  - Tick 内只更新差异大的百分比。

