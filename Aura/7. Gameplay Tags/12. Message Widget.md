## 12. 在界面上显示消息 Widget

### 1. 接收广播并显示 Widget

- 从 **Widget Controller** 接收到数据表行结构（包含消息和图像）。
- 目标：在屏幕上显示一个消息 Widget。

------

### 2. 创建消息 Widget Blueprint

- 在 **WBP_Overlay** 内新建文件夹 `SubWidgets` 用于子 Widget。
- 创建新 **Widget Blueprint**，基类选择 `AuraUserWidget`。
- 命名为 `WBP_EffectMessage` —— 用来显示效果消息。

------

### 3. 设计消息 UI 布局

- 添加 **Horizontal Box**（水平布局容器），设置为 **Custom Size**。
- 在水平容器中放置：
  - 图像（Image → 命名为 `Image_Icon`）
  - 文本块（Text → 命名为 `Text_Message`）
- 示例文本：`Picked up a health potion`。
- 设置图像 Brush 默认值为 `T_Potion_Red`。
- 调整图像大小为 `75x75`。
- 文本垂直居中，使用 **Amaranth 字体**，设置 Outline（描边）大小为 1。
- 在图像和文字之间加入 **Spacer** 控件增加间距。

------

### 4. 变量化与函数封装

- 将 `Image_Icon` 和 `Text_Message` 勾选为变量。
- 新建函数 `SetImageAndText`：
  - 输入：
    - `Texture2D Image`
    - `Text Message`
  - 设置逻辑：
    - 使用 `SetBrush` 为图像赋值，并通过 `Vector2D ImageSize` 控制大小（默认 `75x75`）。
    - 使用 `SetText` 更新消息文本。

------

### 5. 与数据表绑定

- 在数据表 **MessageWidgetData** 中，为每条消息设置 `MessageWidget = WBP_EffectMessage`。
- 快速操作：选中一个条目后，可用 **左箭头按钮**批量应用相同的 Widget。

------

### 6. 在 Overlay 中创建并显示 Widget

- 使用 **Create Widget** 创建 `WBP_EffectMessage`：
  - `Class` 来自数据表行。
  - `Owning Player` 使用 `GetPlayerController()`。
- Cast 成 `WBP_EffectMessage` → 调用 `SetImageAndText`，传入数据表行中的图像和文本。
- 调用 **AddToViewport** 把 Widget 添加到屏幕。

------

### 7. 调整显示位置

- 默认显示在左上角，需要手动设置位置：
  - 使用 `GetViewportSize` 获取屏幕尺寸。
  - 乘以 `0.5` 得到屏幕中心。
  - 调用 `SetPositionInViewport` 把消息 Widget 放在屏幕中央。

------

### 8. 当前存在的问题

- 每次拾取物品会不断叠加消息 Widget，不会自动消失。
- 水平容器默认拉伸，需通过 Overlay 包裹避免变形。
- 消息过长时需要更大空间。

------

### 9. 下一步改进

- 给 Widget 添加 **显示时长**，超时后销毁。
- 添加 **淡出动画**，提升视觉效果。
- 清理旧的消息，避免屏幕堆叠。

