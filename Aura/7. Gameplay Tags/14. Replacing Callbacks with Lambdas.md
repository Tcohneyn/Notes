好的，我帮你把这段内容整理成 **标题式大纲总结**，突出重点和逻辑顺序：

------

# 使用 Lambda 替换回调函数

## 1. 任务介绍

- 目标：将 Overlay Widget Controller 中的 **回调函数** 替换为 **Lambda 表达式**。
- 原本的做法：属性变化时 → 回调函数 → 广播委托。
- 新做法：直接在 Lambda 内部广播委托。

------

## 2. 清理与修正

- 关闭无关文件（如 Gameplay Tag Container）。
- 修正复制粘贴遗留的问题：
  - `OnMaxHealthChanged` 错误地用了 `OnHealthChanged` 的签名。
  - 修改为正确的签名。
- 注意：虽然能正常工作，但委托签名应该规范。

------

## 3. 使用 Lambda 替换回调

- 核心点：Lambda 的函数签名必须匹配委托要求。
  - 输入参数：`const FOnAttributeChangeData& Data`。
- 替换方式：
  - `AddUObject` → `AddLambda`。
  - Lambda 格式：`[this](const FOnAttributeChangeData& Data) { /*广播*/ };`
  - 使用 `[]` 捕获 `this`。

------

## 4. Lambda 的可读性

- 可以写在单行，更紧凑。
- 也可以分行，更清晰。
- 作者偏好分行，便于维护。

------

## 5. 移除旧的回调函数

- 替换完成后，原有的回调函数已不再需要：
  - 删除对应函数实现。
  - 删除函数声明。
- Widget Controller 更简洁。

------

## 6. 逐个替换属性绑定

- 健康值（Health → OnHealthChanged）。
- 最大健康值（MaxHealth → OnMaxHealthChanged）。
- 魔力值（Mana → OnManaChanged）。
- 最大魔力值（MaxMana → OnMaxManaChanged）。
- 最终：所有回调全部用 Lambda 绑定。

------

## 7. 优化委托声明

- 发现问题：为每个属性单独声明委托，其实都是相同的功能（广播 float）。
- 重构：
  - 统一声明一个委托类型：`FOnAttributeChangedSignature(float NewValue)`。
  - 不同属性使用同一种委托类型。
  - 删除多余的委托声明。
- 好处：减少重复代码，方便扩展更多属性。

------

## 8. 编译与调试

- 代码编译通过（委托只需要广播 float 值）。
- Play 测试时发现蓝图错误：
  - 因为委托签名更新，蓝图节点失效。
  - 解决方法：右键节点 → Refresh Nodes → 重新连接。
- 修复 Health Globe 与 Mana Globe 的蓝图。

------

## 9. 最终测试

- 保存并运行游戏。
- 测试拾取 Mana 与 Health，显示正常。
- 所有功能正常工作。

------

## 10. 总结

- 用 Lambda 替换回调后：
  - **代码更简洁**（无回调函数）。
  - **结构更清晰**（统一委托）。
  - **Widget Controller 更干净**。
- 挑战完成，效果优秀。

