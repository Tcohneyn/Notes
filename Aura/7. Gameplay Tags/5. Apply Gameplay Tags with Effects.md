# Add Gameplay Tags With Gameplay Effects

## 1. Gameplay Tags 的引入与应用场景

- **回顾：** 已经学习了如何在项目中添加 gameplay tags。
- **目标：** 将 gameplay tags 添加到任意 Ability System Component (ASC)。
- **方式：** 有多种方法，其中之一是通过 Gameplay Effects 来实现。

------

## 2. 案例：水晶 (Crystal) 的 Gameplay Effect

- **操作：**
  - 复制一个 Health Crystal 放到 Player Start 附近。
  - 玩家拾取后，生命值在 1 秒内持续增加。
- **实现原因：**
  - 归功于该水晶蓝图中的 Gameplay Effect：`Crystal Heal`。
  - 这是一个 **周期性 (Periodic) Gameplay Effect**。

------

## 3. Gameplay Effect 的 Tag 分类

Gameplay Effects 可以包含多种 tags，每类 tags 功能不同，容易造成混淆。

### 3.1 Asset Tags (Gameplay Effect Asset Tag)

- **特点：**
  - 标签属于 Gameplay Effect 本身，并不会赋予目标角色的 ASC。
  - 仅作为效果自身的标识。
- **用途：**
  - 可用于逻辑判断，例如识别是哪种效果生效了。
- **结构：**
  - `Combined` = (继承 + 添加) − 移除
  - `Added` = 在继承的基础上额外添加的 tags
  - `Removed` = 从继承的父类 tags 中剔除的部分
- **备注：**
  - 通常 Gameplay Effect 不会继承（不像其他 GAS 类），所以 `Removed` 用处较少。

### 3.2 Granted Tags

- **特点：**
  - 这些标签会赋予被命中的角色 ASC。
- **操作示例：**
  - 添加 `Attributes.Vital.Health` 作为 granted tag。
  - 编译后可见标签进入 `Combined` 集合。
  - 在调试界面中，当玩家拾取水晶时，会看到 `Owned Tags` 中出现该标签。
- **标签层级：**
  - 可添加完整路径（`Attributes.Vital.Health`）
  - 也可只加部分层级（如 `Attributes.Vital`）

------

## 4. Duration 与 Instant Gameplay Effect 的区别

### 4.1 Duration-based

- 标签在效果持续期间存在，效果结束时移除。
- 示例：水晶回血持续 4 秒 → `Owned Tags` 中显示 `Attributes.Vital.Health`，计数为 1。

### 4.2 Stackable vs Non-Stackable

- **Stackable (可堆叠)：**
  - 效果叠加，但标签只出现一次（堆叠计数作用在效果上）。
- **Non-Stackable (不可堆叠)：**
  - 每次施加都是新的效果 → 同一个标签可出现多次，计数随效果数量变化。

### 4.3 Instant-based

- 标签不会出现。
- 解释：Instant Effect 只瞬间生效，没有持续时间，因此没有时机给 ASC 添加 tag。

------

## 5. 如何在 Instant Effect 中获取标签信息

- **问题：** Instant Effect 无法通过 Granted Tags 添加标签。
- **解决方案：** 使用 **Asset Tags** 来标记效果本身。
- **场景示例：** 拾取药水时，通过 Asset Tag 识别 → 屏幕显示 “Picked up Health Potion”。

------

## 6. 深入源码：Ability System Component

- **建议：**
  - 打开 `AbilitySystemComponent.h`，这几乎是 GAS 的核心文档。
  - 文件接近 2000 行，充满注释，非常适合当成“官方手册”。
  - 即使不看代码，至少快速扫一遍函数名和注释，形成全局印象。

------

## 7. 关键 Delegate 机制

AbilitySystemComponent 提供了大量委托 (Delegate)，用于监听 Gameplay Effect 生命周期。

### 7.1 OnGameplayEffectApplied

- **To Self:**
  - 在自身应用 Gameplay Effect 时触发（包括 Instant、Duration、Infinite）。
  - 运行在 **Server** 上。
- **To Target:**
  - 在将 Gameplay Effect 应用于他人时触发。

### 7.2 OnActiveGameplayEffectAdded

- **说明：** 仅在 Duration 或 Infinite 效果被添加时触发。
- **Instant 效果不会触发此委托。**

### 7.3 OnPeriodicGameplayEffectExecute

- **说明：** 适用于周期性效果，每次 tick 执行时触发。
- **应用场景：** 例如每秒回血时触发一次。

------

## 8. Replication 策略复习

- **Mixed:**
  - Gameplay Effects 只复制给拥有者客户端。
  - Gameplay Cues & Tags 会同步给所有客户端。
- **Minimal:**
  - Gameplay Effects 不复制。
  - Gameplay Cues & Tags 会同步。
- **Full:**
  - 完整复制效果（本项目未使用）。

------

📌 **总结**

- **Asset Tags**：标记效果自身，不影响 ASC。
- **Granted Tags**：赋予目标角色 ASC，仅在 Duration/Infinite 效果中有效。
- **Stack vs Non-Stack**：效果堆叠和标签堆叠的区别。
- **Instant 效果问题**：通过 Asset Tag + Delegate 解决。
- **源码建议**：阅读 ASC 头文件，掌握常用委托和机制。



------

# 复制模式 (Replication Mode)

| 复制模式              | 使用场景           | 描述                                                         |
| --------------------- | ------------------ | ------------------------------------------------------------ |
| **Full（完整）**      | 单人游戏           | **Gameplay Effects** 会复制到所有客户端                      |
| **Mixed（混合）**     | 多人游戏，玩家控制 | **Gameplay Effects** 只复制到拥有者客户端。**Gameplay Cues** 和 **Gameplay Tags** 会复制到所有客户端。 |
| **Minimal（最小化）** | 多人游戏，AI 控制  | **Gameplay Effects 不会**被复制。**Gameplay Cues** 和 **Gameplay Tags** 会复制到所有客户端。 |

