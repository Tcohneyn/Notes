针对“萨满召唤位置（Shaman Summon Locations）”这一技术实现环节，以下是基于视频/字幕内容的深度技术拆解，涵盖了从 C++ 底层逻辑到数学原理及蓝图应用的完整流程：

### 一、 C++ 类结构设计与参数配置

为了实现灵活的召唤系统，开发者创建了一个名为 `UAuraSummonAbility` 的 C++ 类。

- **基础继承**：继承自 `UAuraGameplayAbility`（基础游戏技能类）。
- **可调参数（`UPROPERTY`）**：
  - **`NumMinions` (int32)**：召唤随从的数量。
  - **`MinionClasses` (TArray<TSubclassOf<APawn>>)**：随从种类的数组，允许萨满同时召唤战士和游侠等多种小恶魔。
  - **距离控制**：`MinSpawnDistance` 和 `MaxSpawnDistance`（浮点型），定义了随从生成的半径区间。
  - **`SpawnSpread` (float)**：定义召唤区域的弧度（如 90 度），确保随从生成在萨满前方的扇形区。

### 二、 核心算法：扇形区域位置计算

这是该技能最核心的数学逻辑，旨在萨满面前计算出一组合理的 3D 坐标点。

#### 1. 获取基准向量

- **起始位置**：获取萨满（AvatarActor）当前的 `GetActorLocation()`。
- **前方向量**：获取 `GetActorForwardVector()`。

#### 2. 计算扇形边界（角度偏移）

为了得到召唤区域的范围，需要将前方向量向左右旋转。

- **逻辑偏移**：如果 `SpawnSpread` 是 90 度，则向左偏移 45 度，向右偏移 45 度。
- **旋转公式**：使用 `ForwardVector.RotateAngleAxis(-SpawnSpread / 2.f, FVector::UpVector)` 计算左侧边界向量，右侧同理。

#### 3. 随机位置生成逻辑

在代码循环中，为每一个随从计算位置：

- **随机角度**：在 `[-SpawnSpread / 2, SpawnSpread / 2]` 之间取随机值，用于旋转前方向量。

- **随机距离**：在 `[MinSpawnDistance, MaxSpawnDistance]` 之间取随机值。

- **合成坐标**：

  C++

  ```
  // 伪代码示例
  FVector ChosenDirection = ForwardVector.RotateAngleAxis(RandomAngle, FVector::UpVector);
  FVector SpawnLocation = ShamanLocation + (ChosenDirection * RandomDistance);
  ```

### 三、 调试可视化（Debug Visualizers）

在正式生成敌人之前，使用调试工具确保位置算法正确，这是防止敌人卡进墙壁或生成位置过远的关键步骤。

- **`DrawDebugArrow`（箭头）**：
  - 绘制绿色箭头代表扇形的右边界。
  - 绘制灰色箭头代表左边界。
- **`DrawDebugSphere`（球体）**：
  - 在萨满周围绘制红色圆环/球体，直观显示随从能够生成的最近和最远边界。
- **作用**：开发者通过这些调试线条，发现 50 的最小距离太近（随从会重叠在萨满身上），从而将其调整为 75。

### 四、 蓝图与行为树集成

当 C++ 算法返回了 `TArray<FVector>` 数组后，剩下的工作在蓝图中完成。

1. **技能逻辑流程**：
   - **触发**：行为树（BT）决定萨满需要使用“召唤”技能。
   - **动画同步**：调用 `PlayMontageAndWait` 播放召唤动画。
   - **逻辑执行**：在动画的特定帧（或技能激活瞬间），调用 C++ 的 `GetSpawnLocations`。
   - **生成循环**：通过 `ForEachLoop` 遍历坐标数组，使用 `SpawnActorFromClass` 节点生成小恶魔。
2. **动态调整性**：
   - **技能等级关联**：视频中提到，未来可以将 `NumMinions` 与技能等级挂钩，实现“等级越高，召唤越多”的效果。
   - **地形适配**：虽然当前是计算平面位置，但后续会通过 `LineTrace`（射线检测）确保生成点在地面上，而不是半空中。

### 五、 最终参数微调结果

经过调试，萨满召唤能力的最终推荐配置为：

- **数量**：5 个随从。
- **扇形张角**：90 度（正前方）。
- **距离区间**：75（最近）到 300（最远）。
- **类别权重**：数组中包含 3 个小恶魔战士和 2 个游侠，确保兵种均衡。