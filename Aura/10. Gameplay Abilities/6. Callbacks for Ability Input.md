# 🎯章节总标题

# 能力输入回调

------

### 🧩一、目标概述

- 目的：将自定义输入组件（`AuraInputComponent`）与玩家控制器整合。
- 实现自动绑定三类输入回调（Pressed、Released、Held），并验证输入绑定系统正常工作。

------

### ⚙️二、准备工作

1. 在 `PlayerController` 中声明一个 **InputConfig 数据资产变量**：
   - 类型：`TObjectPtr<UAuraInputConfig>`
   - 设为 `EditDefaultsOnly`，分类为 “Input”。
   - 用于从蓝图中指定输入配置。
2. 添加三种输入回调函数：
   - `AbilityInputTagPressed(FGameplayTag InputTag)`
   - `AbilityInputTagReleased(FGameplayTag InputTag)`
   - `AbilityInputTagHeld(FGameplayTag InputTag)`
3. 引入 `GameplayTagContainer.h` 以解决标签类型未定义问题。

------

### 🔗三、绑定输入到回调函数

1. 在 `SetupInputComponent()` 中：

   - 将输入组件类型改为 `UAuraInputComponent`。
   - 使用 `CastChecked<UAuraInputComponent>(InputComponent)` 获取实例。

2. 调用自定义绑定函数：

   ```cpp
   AuraInputComponent->BindAbilityActions(InputConfig, this, 
       &ThisClass::AbilityInputTagPressed,
       &ThisClass::AbilityInputTagReleased,
       &ThisClass::AbilityInputTagHeld);
   ```

   - 第一个参数：`InputConfig` 数据资产。
   - 第二个参数：`this`（当前控制器实例）。
   - 后三项：对应三种回调函数。

3. 删除不再需要的 `EnhancedInputComponent` 引用。

------

### 🧠四、调试与验证流程

1. 在三个回调函数中添加 `GEngine->AddOnScreenDebugMessage()` 调试输出：
   - Pressed：红色、Key=1。
   - Released：蓝色、Key=2。
   - Held：绿色、Key=3。
   - 打印输入标签名称以验证回调是否接收到正确标签。
2. 确保在 **项目设置 → Input → Default Input Component Class** 中选择 `AuraInputComponent`。
3. 运行时验证：
   - 鼠标左键：红（按下）→ 绿（持续）→ 蓝（释放）。
   - 右键与数字键（1~4）同样触发对应标签显示。
   - 说明输入绑定与数据驱动系统已成功生效。

------

### ⚡五、关键问题与修复

- **首次调试中触发断点**：因 `InputConfig` 未设置导致空指针。
- 修复方法：在蓝图中为 PlayerController 设置正确的 InputConfig 资产。

------

### 🧩六、成果与意义

| 功能               | 说明                                    |
| ------------------ | --------------------------------------- |
| ✅ 数据驱动输入系统 | 通过 DataAsset 统一管理输入与标签       |
| ✅ 自动化绑定       | 使用模板函数一键绑定多组输入            |
| ✅ 可视化验证       | OnScreenDebugMessage 验证输入与回调对应 |
| ✅ 高扩展性         | 能力输入与标签映射可在运行时重配置      |

------

### 🚀七、下一步计划

- 将 **Gameplay Ability** 与 **输入标签** 关联。
- 实现通过标签激活对应能力。
- 探讨输入重映射与运行时切换功能。

------

### 🧱八、额外优化建议

- 三个输入函数可声明为 `static`（无需实例成员）。
- `CursorTrace` 函数可简化、提升可读性。
- 后续将进行控制器代码重构与结构优化，使整体更专业整洁。