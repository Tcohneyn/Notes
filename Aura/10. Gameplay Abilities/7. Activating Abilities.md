### 🎯章节总标题：启动输入标签与能力激活系统的实现（Activating Abilities）

------

#### 一、为能力类添加启动输入标签（Startup Input Tag）

- 在 `AuraGameplayAbility` 类中添加 `StartupInputTag` 成员变量。
- 用于标识该能力在游戏开始时绑定的输入标签（仅适用于启动能力）。
- 设置属性：`EditDefaultsOnly`，分类为 “Input”。
- 不会在运行时修改，仅在启动时用于初始化。

------

#### 二、启动能力与动态标签的关联（Dynamic Ability Tags）

- 游戏开始时由 `AbilitySystemComponent` 赋予启动能力。
- 若能力有有效的 `StartupInputTag`，则在创建 `AbilitySpec` 时：
  - 将该标签添加至 `AbilitySpec.DynamicAbilityTags`。
- `DynamicAbilityTags` 可在运行时动态修改（添加或移除）。
- 因此输入映射可在运行中调整，例如从左键改为右键。

------

#### 三、能力授予逻辑更新（Grant Ability Flow）

- 在 `AddCharacterAbilities()` 中：
  - 遍历启动能力。
  - 检查是否为 `AuraGameplayAbility` 类型。
  - 若有 `StartupInputTag`，添加到 `DynamicAbilityTags`。
  - 然后调用 `GiveAbility()` 授予角色。
- 不再使用 `GiveAbilityAndActivateOnce()`。

------

#### 四、输入事件绑定与控制器通信（Input Binding & Player Controller）

- 在 `PlayerController` 中为每个输入动作绑定：
  - `Pressed`、`Held`、`Released` 三种回调。
- 当触发输入时，通过输入标签调用 `AbilitySystemComponent`：
  - `AbilityInputTagHeld()`
  - `AbilityInputTagReleased()`

------

#### 五、缓存能力系统组件引用（GetASC 缓存机制）

- 为避免频繁类型转换，在控制器中缓存 `AuraAbilitySystemComponent` 引用。
- 实现 `GetASC()` 函数：
  - 若为空则使用 `UAbilitySystemBlueprintLibrary::GetAbilitySystemComponent(GetPawn())` 获取。
  - 并进行类型转换。
  - 若未初始化则返回空指针。

------

#### 六、输入事件的安全调用（Held / Released）

- `AbilityInputTagHeld()` / `Released()` 调用前先判断：
  - 若 `GetASC()` 为空（系统未初始化），则直接返回。
- 保证初始化时不触发异常或访问无效内存。

------

#### 七、能力系统组件中的输入响应逻辑（ASC Input Handling）

- 定义函数：
  - `AbilityInputTagHeld(const FGameplayTag& InputTag)`
  - `AbilityInputTagReleased(const FGameplayTag& InputTag)`
- 检查 `InputTag` 是否有效。
- 通过 `GetActivatableAbilities()` 获取可激活能力列表。
- 遍历 `AbilitySpecs`：
  - 若 `DynamicAbilityTags` 中包含该输入标签 → 激活能力。
  - 若能力已激活 → 不重复激活。
- 释放时同理，调用结束或取消能力逻辑。

------

#### 八、总结（系统设计意义）

- `StartupInputTag` 用于**初始绑定输入与能力**。
- `DynamicAbilityTags` 实现**运行时输入映射灵活性**。
- `ASC` 的输入响应实现了**输入到能力激活的桥梁**。
- `GetASC` 缓存减少了性能开销与无效转换。
- 整个系统确保了：
  - 可扩展性（可动态绑定输入）
  - 安全性（延迟初始化与空指针检测）
  - 清晰的输入逻辑分层（Controller → ASC → Ability）