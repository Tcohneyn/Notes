# Aura Projectile Spell 游戏能力开发大纲

## 1. 目标与现状

- 当前能力：
  - 打印字符串，仅在 `ActivateAbility` 中执行。
  - 需要扩展功能 → 生成投射物（Projectile）。
- 打算：
  - 在服务器端生成投射物。
  - 投射物可被客户端同步（Replicated Actor）。

## 2. 设置投射物类

- 增加 `SubclassOf` 变量：
  - 类型：AuraProjectile
  - 修饰：
    - `EditAnywhere`
    - Blueprint 只读
    - `Protected`
- Forward Declare：`class AAuraProjectile;`

## 3. 服务器端生成逻辑

- 使用 `HasAuthority` 判断：
  - 传入 `ActivationInfo` 指针
  - 返回布尔值：是否为服务器或单机
- 若不是服务器 → 提前返回，不生成投射物
- 投射物在服务器生成，客户端仅看到复制版本

## 4. 投射物生成步骤

- 使用 `SpawnActorDeferred` 代替普通 `SpawnActor`：
  - 优点：可在生成前设置属性（如 GameplayEffect）
  - 模板类型：`AAuraProjectile`
  - 参数：
    - 类：`ProjectileClass`
    - Transform：`SpawnTransform`
    - Owner：Ability 的拥有者
    - Instigator：拥有者 Cast 成 Pawn
    - Collision Handling Method：`AlwaysSpawn`
- 完成生成：
  - `FinishSpawningActor(SpawnTransform)`

## 5. 投射物生成位置

- 目标：武器尖端（Tip Socket）而非角色位置
- 解决方案：
  - 创建 `ICombatInterface` 接口
    - 虚函数：`GetCombatSocketLocation() → FVector`
    - Aura Character & Aura Enemy 实现
  - 在角色基类中实现：
    - 返回 Weapon 的 Socket 位置
    - 定义 `FName WeaponTipSocketName` 用于标识尖端 Socket
- 投射物生成位置：
  - 使用接口获取的 Socket Location 设置 Transform

## 6. 旋转与瞄准（待完成）

- 当前投射物旋转未定义 → 默认 `ZeroRotator`
- 需要方法获取玩家瞄准方向 / 点击位置
- 保持接口抽象，不依赖具体角色类

## 7. 测试与调试

- 确认：
  - 角色 Weapon 的 Tip Socket 已设置
  - Ability Blueprint 的 Projectile Class 已设置（如 BP_Firebolt）
- 测试结果：
  - 投射物在武器尖端生成
  - 能够发射，但方向固定（旋转未实现）
  - Blueprint Event Graph 可清空，逻辑在 C++ 实现

## 8. 待办事项 (TODO)

- 设置投射物旋转（瞄准）
- 设置投射物的 GameplayEffectSpec（伤害等效果）
- 播放动画蒙太奇：
  - Cast Firebolt 动画
  - 投射物生成与动画同步
- 学习与实现 Ability Tasks 提升能力丰富度

## 9. 小结与展望

- 已实现里程碑：
  - Gameplay Ability 能生成投射物
  - 使用接口解耦角色类
- 下一步：
  - 改善投射物旋转与瞄准
  - 添加伤害效果与动画同步
  - 掌握 Ability Tasks 进行更复杂的能力实现

