### 🎯 总标题：创建并授予基础 Gameplay Ability（基础技能系统实现）

------

#### 一、创建基础 Gameplay Ability 类

- 在 C++ 中新建一个继承自 `UGameplayAbility` 的类，用作所有技能的基类。
- 路径：`C++ Classes/Public/AbilitySystem/Abilities`。
- 命名示例：`AuraGameplayAbility`（或根据项目前缀命名）。
- 创建后 `.h` 和 `.cpp` 文件为空，用于日后扩展通用功能。

------

#### 二、角色类中添加技能数组

- 在 `AuraCharacterBase` 中添加一个 `TArray<TSubclassOf<UGameplayAbility>> StartupAbilities`。
- 使用 `UPROPERTY(EditAnywhere, Category = "Abilities")` 标记。
- 用于存放游戏开始时应授予角色的技能。
- 定义为私有成员。

------

#### 三、添加授予技能的函数

1. **角色类中添加函数**

   - 新建 `void AddCharacterAbilities();`（Protected）。

   - 仅在服务器端执行：

     ```cpp
     if (!HasAuthority()) return;
     ```

   - 通过 Ability System Component 调用授予函数。

2. **Ability System Component 中实现授予逻辑**

   - 新建 `void AddCharacterAbilities(const TArray<TSubclassOf<UGameplayAbility>>& StartupAbilities);`

   - 遍历数组，为每个 Ability 类创建 `FGameplayAbilitySpec`：

     ```cpp
     FGameplayAbilitySpec AbilitySpec(AbilityClass, 1);
     ```

   - 使用以下方法授予：

     - `GiveAbility(AbilitySpec)`
     - 或 `GiveAbilityAndActivateOnce(AbilitySpec)`（立即激活）

   - 注意：后者的参数不能为 `const`。

------

#### 四、在角色中调用授予函数

- 在 `PossessedBy()` 中调用 `AddCharacterAbilities()`。
- 确保在调用 `InitAbilityActorInfo()` 之后执行。
- 使用 `CastChecked<UAuraAbilitySystemComponent>` 获取组件引用。

------

#### 五、在蓝图中设置与测试技能

1. **创建测试技能蓝图**
   - 基于 `AuraGameplayAbility` 创建 `GA_TestGameplayAbility`。
   - 编辑事件图表：
     - 在 `Event ActivateAbility` 打印 “Test Ability Activated”。
     - 在 `Event EndAbility` 打印 “Test Ability Ended”。
     - 使用 `Delay(5.0)` 后调用 `EndAbility()`。
2. **在角色蓝图中添加技能**
   - 打开 `BP_AuraCharacter`，在 `Startup Abilities` 中添加刚创建的 `GA_TestGameplayAbility`。
3. **运行测试**
   - 编译、保存并运行游戏。
   - 运行后应显示：
     - “Test Ability Activated” → 延迟 5 秒 → “Test Ability Ended”。

------

#### 六、总结

- ✅ 创建了基础技能类 `AuraGameplayAbility`。
- ✅ 在角色类中添加了启动技能数组。
- ✅ 编写了授予技能的函数并在服务器端调用。
- ✅ 创建了测试用技能蓝图验证激活与结束逻辑。
- ✅ 实现了从角色 → AbilitySystem → GameplayAbility 的完整授予与激活流程。

