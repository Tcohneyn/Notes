### 🎯 Click to Move（点击移动）系统实现概要

#### 一、目标

实现 **Click to Move（点击移动）** 功能，主要逻辑在 **PlayerController** 中完成。

------

#### 二、PlayerController 基础设置

- 关闭无关文件，仅保留 `AuraPlayerController.h` 与 `.cpp`。
- 参考 **Top Down 模板**，但做自定义调整。

------

#### 三、内部变量设计

| 变量名                    | 类型                | 说明                              |
| ------------------------- | ------------------- | --------------------------------- |
| `CachedDestination`       | `FVector`           | 缓存点击目标位置                  |
| `FollowTime`              | `float`             | 鼠标按下时间累计                  |
| `ShortPressThreshold`     | `float`             | 判断短按与长按的阈值（约 0.5 秒） |
| `bAutoRunning`            | `bool`              | 是否处于自动运行状态              |
| `AutoRunAcceptanceRadius` | `float`             | 自动寻路终点接受半径（默认 50.f） |
| `Spline`                  | `USplineComponent*` | 路径平滑曲线组件                  |
| `bTargeting`              | `bool`              | 当前鼠标是否指向敌人目标          |

------

#### 四、组件初始化

- 在构造函数中创建 `SplineComponent`：

  ```cpp
  Spline = CreateDefaultSubobject<USplineComponent>(TEXT("Spline"));
  ```

- 初始化变量：

  ```cpp
  CachedDestination = FVector::ZeroVector;
  FollowTime = 0.f;
  ShortPressThreshold = 0.5f;
  bAutoRunning = false;
  AutoRunAcceptanceRadius = 50.f;
  bTargeting = false;
  ```

------

#### 五、输入逻辑划分

##### 1️⃣ **鼠标左键按下 (AbilityInputTagPressed)**

- 通过 GameplayTag 判断是否为 **左键输入**。

- 设置：

  ```cpp
  bTargeting = (ThisActor != nullptr);
  bAutoRunning = false; // 重置自动运行状态
  ```

- 若当前目标有效（鼠标在敌人上），准备尝试激活技能，否则继续检测短按移动。

------

##### 2️⃣ **鼠标按住 (AbilityInputTagHeld)**

- 若输入 **不是左键** → 交由 Ability System 处理技能输入。

- 若输入 **是左键**：

  - 若正在 `bTargeting == true` → 激活技能。

  - 否则（没有目标）→ 进入 **点击移动逻辑**：

    - 增加 `FollowTime += DeltaSeconds`

    - 执行鼠标射线检测：

      ```cpp
      if (GetHitResultUnderCursor(ECC_Visibility, false, Hit))
          CachedDestination = Hit.Location;
      ```

    - 获取 Pawn 并调用：

      ```cpp
      ControlledPawn->AddMovementInput((CachedDestination - ControlledPawn->GetActorLocation()).GetSafeNormal());
      ```

------

#### 六、短按与自动寻路逻辑

- 短按释放时（在 `FollowTime < ShortPressThreshold`）→ 将生成路径点，并启用自动运行（后续章节实现）。
- 自动运行状态下每帧移动角色，直到距离终点小于 `AutoRunAcceptanceRadius` 时停止。

------

#### 七、功能测试阶段

- 当前版本仅支持“按住左键持续移动”。
- 暂未实现：
  - 点击释放后自动寻路；
  - 路径点（Spline Path）生成；
  - 自动停止机制。
- 当前逻辑已支持多人同步（`AddMovementInput` 在客户端生效）。

------

**下一步章节：** 实现 **路径点生成 + Spline 自动寻路行为**。