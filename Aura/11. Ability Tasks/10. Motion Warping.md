# Motion Warping

------

## 一、引入与目标

- 已能让投射物正确发射方向
- 角色 Aura 未面向正确方向
- 目标：让角色自动朝向施法方向
- 方案：使用 **Motion Warping（动作扭曲）**

------

## 二、Motion Warping 功能简介

- Unreal Engine 新特性（Beta）
- 作用：
  - 可在蒙太奇中控制角色**移动或朝向目标**
- 使用前提：动画需启用 **Root Motion（根运动）**

------

## 三、启用与配置 Motion Warping 插件

- 在 `Edit → Plugins` 中搜索 “Motion Warping”
- 启用插件（Beta 警告，非发布项目可用）
- 重启编辑器后插件生效

------

## 四、为角色添加 Motion Warping 组件

- 打开 Aura 角色蓝图
- 添加组件：**Motion Warping Component**
- 允许在动画蒙太奇中使用 Motion Warping

------

## 五、在蒙太奇中添加 Motion Warping 区段

- 打开 `AM_Cast_Firebolt` 蒙太奇
- 添加两个 Notify Track：
  - `Events`
  - `Motion Warping`
- 在施法前动作段添加 **Motion Warping State**
- 配置参数：
  - Root Motion Modifier → “Skew Warp”
  - Warp Target Name → “FacingTarget”
  - 取消 Warp Translation（不改变位置）
  - 保留 Warp Rotation（只旋转朝向）
  - Rotation Type → “Facing”

------

## 六、设置 Warp Target（朝向目标）

- 在 Aura Character 蓝图中新建自定义事件：`SetFacingTarget`
- 调用 Motion Warping 组件函数：
  - `Add or Update Warp Target from Location`
  - 输入参数：`FacingTarget`（Vector 类型）
  - Warp Target 名称一致（FacingTarget）

------

## 七、从 Firebolt 技能中传入目标点

- 在 Firebolt Ability 蓝图中：
  - 获取 `Avatar Actor`（角色引用）
  - Cast 到 `BP_AuraCharacter`
  - 调用 `SetFacingTarget`，传入 `ProjectileTargetLocation`
  - 播放蒙太奇以观察角色朝向变化
- 测试结果：
  - 客户端与服务器均能正确朝向目标

------

## 八、问题修复与依赖关系说明

- 蓝图节点需刷新（Refresh Nodes）以修复连线问题
- 当前实现存在依赖：
  - Firebolt Ability 依赖 Aura Character
  - Aura Character 不依赖 Ability（单向依赖）
- 为了支持敌人或其他角色：
  - 应使用 **接口（Combat Interface）** 替代直接 Cast

------

## 九、任务：改用 Combat Interface 实现

- 在 `ICombatInterface` 中添加函数：

  ```cpp
  UFUNCTION(BlueprintImplementableEvent, BlueprintCallable)
  void UpdateFacingTarget(const FVector& Target);
  ```

- 关键属性：

  - `BlueprintImplementableEvent`：可在蓝图实现
  - `BlueprintCallable`：可从蓝图调用
  - `BlueprintType`：允许蓝图中使用接口

- 注意事项：

  - 此类函数**不能标记为 virtual**
  - 若为 BlueprintNativeEvent，则部分逻辑可写在 C++

------

## 十、Blueprint 与 C++ 的整合步骤

1. 在接口中添加 `UpdateFacingTarget` 函数
2. 标记为 BlueprintType、BlueprintCallable、BlueprintImplementableEvent
3. 在 Aura Character 蓝图中实现此函数
4. 删除旧的 `SetFacingTarget` 事件
5. 在 Firebolt Ability 中：
   - 从 Avatar Actor Cast 到 Combat Interface
   - 调用 `UpdateFacingTarget` 并传入目标位置

------

## 十一、常见问题与解决

- 若无法 Cast 到接口 → 缺少 `BlueprintType`
- 若无法调用接口函数 → 缺少 `BlueprintCallable`
- 修改后需重新编译并重启编辑器

------

## 十二、最终验证与结果

- 在编辑器中测试：
  - 按住 Shift 发射 → 角色旋转朝向正确
  - 客户端与服务器同步正常
- Firebolt 现在与 Aura Character 解耦
  - 可复用于敌人等角色
  - 只需目标角色实现 Combat Interface

------

## 十三、总结与拓展

- 本节实现了通过 Motion Warping 让角色自动面向目标
- 完成从蓝图事件到接口的灵活化改造
- 提升了技能系统的通用性与可扩展性
- 下节内容将继续完善技能表现

------

> 