# 投射物效果

------

### 1. 为投射物添加命中效果

- 当前投射物只能飞行，无实际命中反馈。
- 本视频目标：在命中时触发视觉与音效效果。

### 2. 定义命中特效与音效变量

- 在投射物类中添加私有成员：
  - `ImpactEffect`（UNiagaraSystem 类型）
  - `ImpactSound`（USoundBase 类型）
- 在 `.Build.cs` 中加入 Niagara 依赖模块。
- 属性设置为 `EditAnywhere`，便于蓝图中编辑。

### 3. 实现命中时的音效与特效播放

- 在 `OnSphereOverlap` 中实现命中逻辑：
  - 使用 `UGameplayStatics::PlaySoundAtLocation` 播放音效。
  - 使用 `UNiagaraFunctionLibrary::SpawnSystemAtLocation` 生成粒子特效。
- 包含必要头文件（`Kismet/GameplayStatics.h`）。
- 当服务器端拥有权限时销毁投射物。

### 4. 处理销毁与客户端同步问题

- 可能出现销毁先于客户端重叠事件的情况。
- 通过布尔变量 `bHit` 标识是否已触发命中效果。
- 重写 `Destroyed()` 函数：
  - 若 `!bHit && !HasAuthority()` 则在销毁前补播放命中特效。

### 5. 在编辑器中测试命中效果

- 在蓝图中设置 ImpactEffect 与 ImpactSound。
- 选用火球爆炸 Niagara 效果与 Firebolt Impact 音效。
- 实机测试：确认命中时播放正确的音效与爆炸特效。

### 6. 为技能施法添加施放音效

- 在动画蒙太奇（Cast Firebolt Montage）中添加音效通知（Notify）。
- 使用 `SFX_Firebolt` 声音文件。
- 分别在客户端与服务器测试播放效果。

### 7. 任务：为投射物添加循环音效

- 在投射物上添加循环播放的“嘶嘶”声（`SFX_Firebolt_Hiss`）。
- 使用 `UGameplayStatics::SpawnSoundAttached` 实现绑定到根组件。
- 保存返回的音频组件指针 `LoopingSoundComponent`，用于后续停止播放。

### 8. 停止循环音效

- 在 `OnSphereOverlap` 与 `Destroyed()` 中调用 `LoopingSoundComponent->Stop()`。
- 确保命中或销毁后声音停止播放。

### 9. 设置投射物寿命

- 添加属性 `Lifespan`（默认 15 秒，`EditDefaultsOnly`）。
- 在 `BeginPlay()` 中调用 `SetLifeSpan(Lifespan)`。
- 防止火球无限存在于世界中。

### 10. 小结与下步目标

- 现在投射物具有完整的命中视觉与音效反馈。
- 具备循环音效与寿命控制。
- 下一步将在命中时造成伤害，完成投射物的战斗功能。

