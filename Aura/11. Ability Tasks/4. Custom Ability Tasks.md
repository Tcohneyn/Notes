# åŸºäºé¼ æ ‡ä½ç½®çš„æŠ€èƒ½ç›®æ ‡æ•è·ä¸å¼‚æ­¥Ability Taskç³»ç»Ÿ

------

## âœ… æœ¬æ®µå†…å®¹æ ¸å¿ƒè®²äº†ä»€ä¹ˆï¼Ÿ

**ç›®æ ‡ï¼š**
 è§£å†³æ–½æ”¾ç«çƒæŠ€èƒ½ï¼ˆFireboltï¼‰æ—¶ï¼Œæ— æ³•æ ¹æ®é¼ æ ‡ä½ç½®ç¡®å®šå‘å°„æ–¹å‘çš„é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦è·å–**é¼ æ ‡æŒ‡å‘ä½ç½®ï¼ˆHit Result Under Cursorï¼‰**çš„æ•°æ®ï¼Œå¹¶ç”¨äºæŠ€èƒ½çš„æ–¹å‘ä¸è§’è‰²æœå‘ã€‚

------

## âœ… è§£å†³æ–¹å¼æµç¨‹æ¦‚è¿°

### ğŸ›  1. åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ Ability Task

åœ¨ C++ ä¸­åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª `UAbilityTask` çš„ç±»ï¼Œç”¨äºè·å–é¼ æ ‡ä½ç½®çš„ç›®æ ‡æ•°æ®ã€‚

ç±»åå‘½åä¸ºï¼š

```cpp
UTargetDataUnderMouse
```

æ”¾ç½®è·¯å¾„ï¼š
 `Aura/Public/AbilitySystem/AbilityTasks/`

------

### ğŸ§± 2. åœ¨ Ability Task ä¸­åˆ›å»ºé™æ€å·¥å‚å‡½æ•°

```cpp
UFUNCTION(BlueprintCallable, Category = "Ability|Tasks",
    meta = (DefaultToSelf = "OwningAbility", HidePin = "OwningAbility",
            BlueprintInternalUseOnly = "true",
            DisplayName = "Target Data Under Mouse"))
static UTargetDataUnderMouse* CreateTargetDataUnderMouse(UGameplayAbility* OwningAbility);
```

- ç”¨äºåœ¨ Blueprint ä¸­åˆ›å»ºæ­¤ Taskã€‚
- é»˜è®¤ä¼ å…¥å½“å‰ Abilityï¼ˆSelfï¼‰ã€‚

------

### ğŸ“Œ 3. æ”¯æŒè“å›¾è¾“å‡ºæ‰§è¡Œå¼•è„šï¼ˆDelegateï¼‰

åˆ›å»ºä¸€ä¸ªå¤šæ’­ä»£ç†ï¼ˆDelegateï¼‰ï¼Œç”¨ä½œèŠ‚ç‚¹çš„â€œæ‰§è¡Œè¾“å‡ºå¼•è„šâ€ï¼š

```cpp
DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam(FMouseTargetData, const FVector&, Data);

UPROPERTY(BlueprintAssignable)
FMouseTargetData ValidData;
```

------

### âš™ 4. é‡å†™ Activate()

å½“ä»»åŠ¡å¼€å§‹æ—¶ä¼šè°ƒç”¨ `Activate()`ï¼Œä½ éœ€è¦åœ¨è¿™é‡Œï¼š

1. è·å– PlayerControllerã€‚
2. ä½¿ç”¨ `GetHitResultUnderCursor()` è·å–é¼ æ ‡æŒ‡å‘çš„ä¸–ç•Œä½ç½®ã€‚
3. æå– Hit.Locationã€‚
4. è°ƒç”¨ `ValidData.Broadcast(Location);` å‘ Blueprint è¾“å‡ºæ•°æ®ã€‚

------

### ğŸ§ª 5. åœ¨ Firebolt Ability ä¸­æµ‹è¯•

åœ¨ Blueprint â†’ Firebolt Ability ä¸­ï¼š

1. æ¿€æ´»æ—¶è°ƒç”¨è¯¥ Ability Taskï¼ˆTarget Data Under Mouseï¼‰ã€‚
2. åœ¨ ValidData è¾“å‡ºå¼•è„šæ¥æ”¶ FVectorï¼ˆç›®æ ‡åæ ‡ï¼‰ã€‚
3. ç”¨ `Draw Debug Sphere` åœ¨ä¸–ç•Œä¸­å¯è§†åŒ–è¿™ä¸ªä½ç½®ï¼Œç¡®è®¤æ˜¯å¦æˆåŠŸã€‚

------

## âœ… å½“å‰é˜¶æ®µå®Œæˆæ•ˆæœ

âœ” è“å›¾èŠ‚ç‚¹å·²ç»åˆ›å»ºå‡ºæ¥ï¼Œå¹¶æ˜¾ç¤ºä¸ºå¼‚æ­¥èŠ‚ç‚¹ï¼ˆæœ‰æ—¶é’Ÿå›¾æ ‡ï¼‰ã€‚
 âœ” èƒ½æˆåŠŸåˆ›å»ºå¯¹è±¡å¹¶è¾“å‡ºåå­—ï¼Œä½†**è¿˜æœªå®ç°å®é™…ä½ç½®è·å–ä¸å¹¿æ’­**ã€‚
 âœ” ä¸‹ä¸€æ­¥éœ€è¦ä½ å®Œæˆ Activate å¹¶å¹¿æ’­ä½ç½®ã€‚

------

## âœ… ä¸‹ä¸€æ­¥ä½ åº”è¯¥åšçš„äº‹

åœ¨ `Activate()` å‡½æ•°ä¸­å®Œæˆä»¥ä¸‹é€»è¾‘ï¼š

```cpp
void UTargetDataUnderMouse::Activate()
{
    if (APlayerController* PC = Cast<APlayerController>(Ability->GetCurrentActorInfo()->PlayerController))
    {
        FHitResult HitResult;
        PC->GetHitResultUnderCursor(ECC_Visibility, false, HitResult);
        FVector Location = HitResult.ImpactPoint;

        ValidData.Broadcast(Location);
    }

    EndTask(); // ä»»åŠ¡å®Œæˆ
}
```

ç„¶ååœ¨ Firebolt Ability â†’ è“å›¾ä¸­è¿æ¥è¾“å‡ºï¼Œç”» Debug Sphere æµ‹è¯•å³å¯ã€‚

