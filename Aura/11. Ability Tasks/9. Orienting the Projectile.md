# **确定抛射体方向**

------

## 一、客户端到服务器的数据传输与投射物方向

- 客户端点击位置成功传递到服务器
- 服务器可根据点击位置确定投射方向
- 本节目标：让投射物沿正确方向飞行

------

## 二、在 C++ 中修改投射物生成逻辑

- 打开 `AuraProjectileSpell` 类
- 为 `SpawnProjectile` 函数添加输入参数：**目标位置（FVector）**
- 使用 `socket location` 与 `target location` 计算旋转方向
- 通过 `DotRotation()` 获得 Rotator 并转换为 Quaternion
- 调整 pitch 角度：
  - 默认水平（pitch = 0）
  - 可设计为上抛轨迹（pitch = 25~35）
- 设置 `SpawnTransform` 的旋转以修正飞行方向

------

## 三、蓝图中传递点击位置并生成投射物

- 打开 **Firebolt Ability 蓝图**
- 取鼠标点击命中位置 (`Hit Result Location`)
- 将位置缓存为变量：`ProjectileTargetLocation`
- 传入 `SpawnProjectile` 函数
- 删除 `DrawDebugSphere` 调试节点
- 修正 `EndAbility` 调用时机（避免立即取消）
- 测试结果：
  - 服务器生成正确方向的火球
  - 客户端未显示 → 问题源于过早结束能力
  - 移除立即 `EndAbility` 后一切正常

------

## 四、修复角色遮挡摄像机的问题

- 摄像机被角色胶囊体与网格体阻挡导致镜头缩放

- 检查 `Capsule` 与 `Mesh` 的碰撞设置

- 修改为忽略相机通道：

  ```cpp
  GetCapsuleComponent()->SetCollisionResponseToChannel(ECC_Camera, ECR_Ignore);
  GetMesh()->SetCollisionResponseToChannel(ECC_Camera, ECR_Ignore);
  ```

- 武器无碰撞，无需修改

- 运行测试：摄像机缩放问题修复

------

## 五、添加 Shift 键触发机制（自由施法）

- 新建输入动作：`IA_Shift`（Axis1D Float）
- 绑定左右 Shift 键
- 在输入映射中加入到 `MC_AuraContext`
- 在 PlayerController 中：
  - 新建变量 `ShiftAction`
  - 绑定输入事件 `ShiftPressed` 与 `ShiftReleased`
  - 新建布尔值 `bShiftKeyDown` 控制是否按住 Shift
- 修改鼠标左键逻辑：
  - 若鼠标悬停目标或按住 Shift → 激活技能
  - 若无目标且未按 Shift → 移动角色
  - 鼠标释放时都通知能力系统组件（ASC）
  - 防止 Shift 状态下角色移动

------

## 六、功能测试与验证

- 测试服务器与客户端投射逻辑
- 按住 Shift + 左键可自由方向施放火球
- 松开 Shift 仍可正常移动
- 按住 Shift 不触发移动命令
- 行为逻辑符合预期

------

## 七、后续优化方向

- 施放火球时角色需转向发射方向
- 下节视频将实现角色朝向控制

------

> 