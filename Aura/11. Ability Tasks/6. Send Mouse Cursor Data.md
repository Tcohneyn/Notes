# **发送鼠标光标数据**

------

### 1. 引入

- 欢迎回到视频。
- 当前讨论的是在自定义 Ability Task 中实现获取鼠标光标下的数据。

### 2. 本地玩家控制的处理

- 发现仅通过获取鼠标光标数据并广播无法实现目标。
- 对于非本地控制的玩家，光标数据无效。
- 需要一个函数用于在本地控制时将数据发送到服务器。

### 3. 创建“发送鼠标光标数据”函数

- 在 `TargetDataUnderMouse` 类中创建私有函数 `SendMouseCursorData`。
- 若本地控制，则广播委托并发送数据到服务器。

### 4. 判断本地控制状态

- 在 `Activate` 函数的开始，检查是否为本地控制。
- 如果是，调用 `SendMouseCursorData` 函数。
- 否则，添加处理 TODO：在服务器上监听目标数据。

### 5. 目标数据类型

- `FGameplayAbilityTargetData` 是目标数据的基础结构体。
- 具体使用 `FGameplayAbilityTargetData_SingleTargetHit` 类型，用于单一命中结果。
- 目标数据对象创建并设置命中结果。

### 6. 发送目标数据到服务器

- 使用 Ability System Component 发送数据到服务器。
- 需要构建 `FGameplayAbilityTargetDataHandle` 对象并将目标数据添加到其中。
- 调用 `ServerSetReplicatedTargetData` 函数将数据发送到服务器。

### 7. 预测键与数据广播

- 通过 `ScopedPredictionKey` 处理预测机制，确保数据同步。
- 使用 `ScopedPredictionWindow` 来标识预测作用范围。
- 调用 `shouldBroadcastAbilityTaskDelegates` 来确保仅在必要时广播数据。

### 8. 改变广播数据类型

- 将原始的 `FVector` 类型数据改为 `FGameplayAbilityTargetDataHandle`，以便传递整个目标数据。
- 更新委托来广播新的数据类型。

### 9. 服务器接收数据

- 将目标数据发送到服务器后，服务器需要接收并处理这些数据。
- 预告后续章节将处理服务器端的接收与操作。

### 10. 结语

- 当前已完成 `SendMouseCursorData` 函数的实现。
- 下一步将在服务器端处理接收到的数据。
- 视频结束与预告。

------

