# **【标题大纲式总结｜从事件中生成火球术（Firebolt）】**

## **一、任务介绍**

- 目标：从事件触发中生成火球（Firebolt），而不是在技能激活时立即生成。
- 流程改变：技能激活后 → 等待事件发生 → 事件触发后才生成火球。

## **二、实现思路与关键步骤**

### **1. 改动逻辑位置**

- 原本在 `ActivateAbility()` 中直接生成火球。
- 现调整为：在事件响应中生成 → 需要新建可蓝图调用的函数。

### **2. 创建 SpawnProjectile 函数**

- 在 **AuraProjectileSpell.h** 中创建：
  - `void SpawnProjectile();`
  - 添加 `BlueprintCallable`，归类为 `Projectile` 分类。
  - 作用：从蓝图中调用，响应 Gameplay Event 生成火球。

### **3. 迁移原生成代码**

- 将原本 `ActivateAbility()` 中的发射火球逻辑剪切并移入 `SpawnProjectile()`。
- 权限判断方式调整为：
  - 通过 `GetAvatarActorFromActorInfo()->HasAuthority()` 判断是否为服务器端。

### **4. 蓝图调用流程**

- 在 GA_FireBolt 蓝图中：
  - 使用 **Wait Gameplay Event** 节点。
  - 在 **Event Received** 输出中调用 `SpawnProjectile()`。

## **三、运行测试结果**

- 火球会在动画的指定时刻（如 Anim Notify）生成。
- 可通过修改动画速率（Rate Scale=0.1）慢动作观察触发点。
- 动画触发正确、火球同步生成。

## **四、可进一步优化的内容**

- 生成火球后调用 `EndAbility()`，允许技能再次激活。
- 当前可以快速连发（长按鼠标）→ 后续会加入冷却系统（Cooldown）。
- 后续改进方向：
  - 角色朝向应跟随施法方向。
  - 获取玩家朝向或鼠标点击的空间位置。

## **五、总结**

- 本段核心是：将投射物生成逻辑从技能激活移动到事件响应，使用 **BlueprintCallable 函数 + Gameplay Event** 实现动画与技能逻辑同步。

