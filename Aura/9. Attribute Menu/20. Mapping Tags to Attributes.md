# Unreal Engine 5 C++ Attribute System & Function Pointer 大纲（00:00:00 – 00:37:58）

## 1. 引入与回顾

- 欢迎回到教程。
- 目标：创建 Attribute Menu Widget Controller 并优化 Gameplay Attribute 系统。
- 回顾之前：已创建基本的 Attribute Set 和 Widget Controller。

## 2. 基础概念：Gameplay Tags 与 Attribute Accessors

- 将 Gameplay Tags 映射到 Attribute Accessor 函数。
- 传统方式：使用 Delegate 绑定函数，动态获取属性值。
- 问题：Delegate 语法复杂，代码冗长。

## 3. 使用函数指针替代 Delegate

- 引入 C++ 函数指针以简化绑定。
  - `using` 关键字创建别名（类似 `typedef`）。
  - 函数指针语法示例：返回类型 + 参数列表。
- 创建 T-based Static Delegate Instance：
  - 模板参数：函数返回类型、输入参数列表。
  - User Policy（FDefaultDelegateSetUserPolicy）可选，提供默认策略。
- 结果：
  - 可以绑定静态函数而无需 Delegate。
  - 映射 Gameplay Tags 到函数指针更简洁。

## 4. 实例：Attribute Set 中函数指针的使用

- 在 Attribute Set 构造函数中：
  - 创建函数指针变量，绑定静态函数（如 `GetIntelligenceAttribute`）。
  - 调用函数指针获取 Gameplay Attribute。
- 优势：
  - 不再需要 Delegate 调用。
  - 映射表类型简化为 Tag → Function Pointer。

## 5. 简化类型显示与别名

- C++ 函数指针语法复杂，难以阅读。
- 使用 `typedef` 或现代 C++ `using` 创建类型别名：
  - `FAttributeFuncPointer`：专用于 Gameplay Attribute。
  - `TStaticFuncPointer`：模板化，可绑定任意函数签名。
- 作用：
  - 映射表更直观。
  - 支持泛型函数指针，提高系统扩展性。

## 6. 示例：泛型函数指针

- 使用模板别名创建任意函数签名指针：
  - 示例：返回 float，参数为 int32, float, int32。
  - 可在 Attribute Set 构造函数中绑定并调用。
- 优势：
  - 不受限于固定属性函数签名。
  - 系统可扩展到未来新增属性或不同类型函数。

## 7. Attribute Menu Widget Controller 的优化

- Tags → Attributes Map：
  - 映射 Gameplay Tag 到函数指针。
  - Widget Controller 遍历 Map，调用函数指针获取属性值。
- 添加新属性（如 Resilience, Vigor）：
  - 仅需在 Attribute Set 中注册函数指针。
  - Widget Controller 不需要修改。
- 初始值广播：
  - Widget 接收并显示数值。

## 8. 总结与后续

- 静态函数指针 + 模板别名 = 简化 Delegate 绑定，增强可扩展性。
- 优点：
  - 映射表简洁清晰。
  - 易于维护与扩展。
  - 支持泛型函数指针，适配任意函数签名。
- 后续工作：
  - 当前仅广播初始值。
  - 下一步：处理属性值变化时的动态更新。

------

