# Attribute Menu Widget Controller åˆ¶ä½œæ•™å­¦æ€»ç»“ï¼ˆå®Œæ•´ç¯‡ï¼‰

## ğŸ¯ Quest æ¦‚è¦

**ä»»åŠ¡ç›®æ ‡**ï¼šåœ¨ Unreal Engine ä¸­æ„å»º **Attribute Menu Widget Controller**ï¼Œå¹¶é€šè¿‡ **Aura HUD** ä¸ Blueprint å®Œæˆæ•°æ®äº¤äº’ï¼Œå®ç°å±æ€§èœå•çš„ UI æ§åˆ¶é€»è¾‘ã€‚

------

## ğŸ§­ ä¸€ã€ä»»åŠ¡è¯´æ˜

- æœ¬èŠ‚ä»»åŠ¡ç›®æ ‡ï¼š
  - åˆ›å»º Attribute Menu Widget Controllerã€‚
  - ä¸º AuraHUD æ·»åŠ å¯¹åº”å¼•ç”¨ä¸è®¿é—®æ¥å£ã€‚
  - ä½¿ Blueprint å¯è°ƒç”¨å¹¶ç»‘å®šè¯¥ Controllerã€‚
- è®¾è®¡æ€è·¯æ¥æºäº Overlay Widget Controller çš„ç»“æ„ã€‚

------

## ğŸ§© äºŒã€Aura HUD ç»“æ„å¤æŸ¥ä¸å˜é‡æ·»åŠ 

### ç°æœ‰å˜é‡

- `OverlayWidgetClass`ï¼ˆWidget å­ç±»å¼•ç”¨ï¼‰
- `OverlayWidgetController`ï¼ˆå®ä¾‹å¼•ç”¨ï¼‰
- `OverlayWidgetControllerClass`ï¼ˆController å­ç±»å¼•ç”¨ï¼‰

### æ–°å¢å˜é‡

- `TObjectPtr<UAttributeMenuWidgetController> AttributeMenuWidgetController`
- `TSubclassOf<UAttributeMenuWidgetController> AttributeMenuWidgetControllerClass`ï¼ˆBlueprint å¯ç¼–è¾‘ï¼‰

> å°æç¤ºï¼š`OverlayWidget` å¯æ”¹ä¸º private æ£€æŸ¥æ˜¯å¦å¼•èµ·æŠ¥é”™ã€‚

------

## âš™ï¸ ä¸‰ã€åˆ›å»º Getter å‡½æ•°

### å‡½æ•°ç­¾å

```cpp
UAttributeMenuWidgetController* AAuraHUD::GetAttributeMenuWidgetController(const FWidgetControllerParams& WCParams);
```

### å®ç°æ­¥éª¤

1. åˆ¤æ–­æ˜¯å¦å·²æœ‰å®ä¾‹ï¼š
    è‹¥ `AttributeMenuWidgetController == nullptr`ï¼š

   ```cpp
   AttributeMenuWidgetController = NewObject<UAttributeMenuWidgetController>(this, AttributeMenuWidgetControllerClass);
   ```

2. è°ƒç”¨ï¼š

   ```cpp
   AttributeMenuWidgetController->SetWidgetControllerParams(WCParams);
   AttributeMenuWidgetController->BindCallbacksToDependencies();
   ```

3. è¿”å› Controllerã€‚

> ä¸ Overlay Controller é€»è¾‘ç›¸åŒï¼Œå¯å»é™¤å†—ä½™ returnã€‚

------

## ğŸ§° å››ã€æ‰©å±• Blueprint Function Library

### æ–°å¢å‡½æ•°

- **åç§°**ï¼š`GetAttributeMenuWidgetController`
- **ç±»å‹**ï¼š`Static Blueprint Pure`
- **è¾“å…¥**ï¼š`const UObject* WorldContextObject`
- **è¿”å›**ï¼š`UAttributeMenuWidgetController*`
- **åˆ†ç±»**ï¼š`Widget Controller`

### å®ç°é€»è¾‘

1. ä» `WorldContextObject` è·å–ï¼š
   - PlayerController
   - AuraHUD
   - PlayerState
   - AbilitySystemComponent (ASC)
   - AttributeSet
2. æ„é€  `FWidgetControllerParams` å‚æ•°ã€‚
3. è°ƒç”¨ AuraHUD çš„ Getter å¹¶è¿”å›ç»“æœã€‚

------

## ğŸ§ª äº”ã€åœ¨è“å›¾ä¸­æµ‹è¯•è°ƒç”¨

1. æ‰“å¼€ **Attribute Menu Widget Blueprint**ã€‚

2. åœ¨ **Event Construct** èŠ‚ç‚¹ä¸­è°ƒç”¨ï¼š

   ```blueprint
   GetAttributeMenuWidgetController(Self)
   â†’ SetWidgetController(è¿”å›å€¼)
   ```

3. è‹¥ Blueprint æ— æ³•è¯†åˆ«ç±»ï¼š

   - åœ¨ C++ ç±»å£°æ˜æ·»åŠ ï¼š

     ```cpp
     UCLASS(BlueprintType, Blueprintable)
     ```

   - é‡æ–°ç¼–è¯‘å¹¶åˆ›å»º `BP_AttributeMenuWidgetController`ã€‚

------

## ğŸ§± å…­ã€åœ¨ HUD Blueprint ä¸­è®¾ç½®å¼•ç”¨

- æ‰“å¼€ **BP_AuraHUD**ã€‚
- å°† `AttributeMenuWidgetControllerClass` æŒ‡å®šä¸º `BP_AttributeMenuWidgetController`ã€‚

------

## ğŸ§­ ä¸ƒã€éªŒè¯è¿è¡Œç»“æœ

- åœ¨ **Attribute Menu Widget Blueprint** çš„ `WidgetControllerSet` äº‹ä»¶ä¸­æ·»åŠ ï¼š

  ```blueprint
  PrintString(GetObjectName(WidgetController))
  ```

- è¿è¡Œæ¸¸æˆï¼Œæ‰“å¼€å±æ€§èœå•ã€‚
   è¾“å‡ºç»“æœï¼š

  ```
  AttributeMenuWidgetController
  ```

âœ… è¡¨ç¤º Controller æˆåŠŸåˆå§‹åŒ–å¹¶ç»‘å®šã€‚

------

## ğŸ§© å…«ã€åœ¨ C++ ä¸­ç»‘å®š UI æ§åˆ¶é€»è¾‘

### åˆ›å»º AttributeMenu åˆå§‹åŒ–å‡½æ•°

- åœ¨ AuraHUD ä¸­æ·»åŠ ï¼š

  ```cpp
  void InitAttributeMenu(APlayerController* PC, APlayerState* PS, UAbilitySystemComponent* ASC, UAttributeSet* AS);
  ```

- å‡½æ•°é€»è¾‘ï¼š

  1. æ£€æŸ¥ Widget Class æ˜¯å¦æœ‰æ•ˆï¼›
  2. é€šè¿‡ `CreateWidget` åˆ›å»º Attribute Menu Widgetï¼›
  3. è°ƒç”¨ `GetAttributeMenuWidgetController`ï¼›
  4. è°ƒç”¨ `SetWidgetController()`ï¼›
  5. è°ƒç”¨ `AddToViewport()`ã€‚

> ä¸ Overlay åˆå§‹åŒ–å‡½æ•°åŸºæœ¬ä¸€è‡´ã€‚

------

## ğŸ§± ä¹ã€åœ¨ PlayerController ä¸­è§¦å‘æ˜¾ç¤º

- åœ¨ `AAuraPlayerController` ä¸­æ·»åŠ é€»è¾‘ï¼š
  - æŒ‰é”®äº‹ä»¶è§¦å‘ Attribute Menu çš„æ˜¾ç¤ºã€‚
  - è°ƒç”¨ AuraHUD çš„ `InitAttributeMenu()`ã€‚

ç¤ºä¾‹ï¼š

```cpp
if (AuraHUD)
{
    AuraHUD->InitAttributeMenu(PlayerController, PlayerState, ASC, AttributeSet);
}
```

------

## ğŸªŸ åã€Blueprint å±‚çš„æ˜¾ç¤ºæ§åˆ¶

- å¯åœ¨ UI å±‚è®¾ç½®ï¼š
  - æ‰“å¼€å±æ€§èœå•ï¼š`AddToViewport()`
  - å…³é—­å±æ€§èœå•ï¼š`RemoveFromParent()`
- å¯æ·»åŠ  **å¸ƒå°”å¼€å…³å˜é‡**ï¼ˆå¦‚ `bIsAttributeMenuVisible`ï¼‰ç”¨äºæ§åˆ¶ã€‚

------

## ğŸ§© åä¸€ã€å®Œå–„äº¤äº’ä¸è°ƒè¯•

- Blueprint ä¸­æ·»åŠ è°ƒè¯•è¾“å‡ºç¡®è®¤ï¼š
  - Controller æ˜¯å¦ç»‘å®šæ­£ç¡®ï¼›
  - å±æ€§æ˜¯å¦åŒæ­¥ï¼›
  - æ•°æ®å›è°ƒæ˜¯å¦è§¦å‘ã€‚
- å¯ä»¥åœ¨ Controller çš„ `BindCallbacksToDependencies()` ä¸­æ·»åŠ æ›´å¤šå§”æ‰˜ç»‘å®šã€‚

------

## ğŸ§  åäºŒã€æ€»ç»“ä¸æå‡

### æœ¬èŠ‚æ”¶è·

- æŒæ¡ HUD ä¸ Widget Controller çš„å®Œæ•´åˆå§‹åŒ–æµç¨‹ã€‚
- ç†è§£ Attribute Menu çš„ç‹¬ç«‹æ§åˆ¶ç»“æ„ã€‚
- å­¦ä¼šé€šè¿‡ Blueprint Function Library åœ¨è“å›¾ä¸­æ–¹ä¾¿åœ°è·å– Controllerã€‚

### è®¾è®¡æ€è·¯

- Controller æŒä¹…å­˜åœ¨ï¼ŒHUD ä»…åˆ›å»ºä¸€æ¬¡åå¤ç”¨ã€‚
- Blueprint é€šè¿‡ç»Ÿä¸€å‡½æ•°è®¿é—®ï¼Œä¿æŒæ¨¡å—åŒ–ä¸è§£è€¦ã€‚
- ç»“æ„ä¸ Overlay ç³»ç»Ÿä¸€è‡´ï¼Œä¾¿äºæ‰©å±•ä¸ç»´æŠ¤ã€‚

------

## âœ… ç»“è¯­

è‡³æ­¤ï¼Œ**Attribute Menu Widget Controller** çš„åˆ›å»ºä¸ç»‘å®šæµç¨‹å…¨éƒ¨å®Œæˆã€‚
 ä½ ç°åœ¨æ‹¥æœ‰ï¼š

- AuraHUD ä¸­çš„åŒæ§åˆ¶å™¨ï¼ˆOverlay + AttributeMenuï¼‰ã€‚
- å®Œæ•´çš„ Blueprint å¯è®¿é—®æ¥å£ã€‚
- ç¨³å®šçš„ UI æ§åˆ¶ä¸å¤ç”¨ç»“æ„ã€‚

