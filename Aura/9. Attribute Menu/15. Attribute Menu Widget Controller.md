# 1. 创建 Attribute Menu Widget Controller 控制器

## 1.1 新任务说明

- 本节任务：创建一个新的 **属性菜单（Attribute Menu）Widget Controller**。
- 类名：`AttributeMenuWidgetController`。
- 继承自：`AuraWidgetController`（基础控制器类）。
- 目的是用于管理属性菜单界面的数据与逻辑。

------

# 2. 新建 Widget Controller 类

## 2.1 类创建步骤

1. 打开 C++ 源码目录：`C++ Classes → Aura → Public → UI → WidgetController`。
2. 在该目录中新建类，基于 `AuraWidgetController`。
3. 命名为 **AttributeMenuWidgetController**。
4. 让编辑器自动关闭并生成新类文件。

## 2.2 文件清理与准备

- 关闭不必要的标签页，仅保留新创建的 Widget Controller 文件。
- 打开 `.h`（头文件）和 `.cpp`（实现文件）准备编写逻辑。

------

# 3. 重写基础函数

## 3.1 创建公共部分（public section）

- 在类的 `public:` 区域声明并重写两个虚函数：

  ```cpp
  virtual void BindCallbacksToDependencies() override;
  virtual void BroadcastInitialValues() override;
  ```

- 这两个函数是 Widget Controller 的核心逻辑函数，用于：

  - **BindCallbacksToDependencies**：绑定依赖（如属性变化回调）。
  - **BroadcastInitialValues**：广播初始属性值给 UI。

## 3.2 函数定义

- 在 `.cpp` 文件中生成函数定义（可自动生成）。
- 当前阶段函数体可留空。

## 3.3 是否调用父类（Super）

- 检查父类 `AuraWidgetController`，发现对应函数为空实现。
- 因此暂时**无需调用 Super::**，但未来若父类添加逻辑，则需手动补上。

------

# 4. AttributeMenuWidgetController 的作用与结构规划

## 4.1 控制器功能

- 用于驱动 **属性菜单界面（Attribute Menu UI）**。
- 负责向 UI 提供属性数据、接收交互并同步数据。

## 4.2 控制器的初始化问题

- 控制器必须在某处被**构造（Constructed）\**并\**存储（Stored）**。
- 当前 Overlay Widget Controller（覆盖界面控制器）是在 **AuraHUD** 中构建。

------

# 5. AuraHUD 中的控制器构造逻辑

## 5.1 现有模式回顾

- `AuraHUD` 类拥有一个 `OverlayWidgetController` 成员变量（私有）。
- 访问方式：通过 **Getter 函数**。
- 若控制器尚未被创建：
  - Getter 会在第一次访问时自动构造它，并返回引用。
- 该机制保证控制器只被创建一次（懒加载）。

## 5.2 拟采用相同模式

- `AttributeMenuWidgetController` 将复用这一结构。
- 在 `AuraHUD` 中添加一个对应成员变量与 Getter：
  - Getter 检查是否存在 → 若无则创建 → 返回引用。
- 这样即可保持统一的管理方式。

------

# 6. 构建控制器的参数与依赖

## 6.1 Widget Controller Params

- 当前控制器的构造依赖一个结构体 `WidgetControllerParams`。
- 该结构封装了四个关键变量（如 AbilitySystem、PlayerState、AttributeSet 等）。
- AuraHUD 会负责组装这些参数后传入控制器构造函数。

------

# 7. 提高 Widget Controller 获取的便利性

## 7.1 问题

- 若在蓝图中，一个 Widget 想设置自己的 Widget Controller：
  - 目前必须先找到 HUD → 再调用 Getter → 才能取得控制器实例。
- 这一流程繁琐，不利于蓝图端的使用。

## 7.2 解决方案：创建 Blueprint Function Library

- 新建一个 **Blueprint Function Library（蓝图函数库）**。
- 该库中定义若干 **静态函数（static functions）**，例如：
  - `GetOverlayWidgetController()`
  - `GetAttributeMenuWidgetController()`

## 7.3 蓝图端调用效果

- 在任意蓝图中可直接调用这些函数获取控制器实例。
- 不必显式查找 HUD、PlayerController 或其他对象。
- 大幅简化蓝图逻辑，提高开发效率。

------

# 8. 项目中 Widget Controller 的设计规范

## 8.1 控制器数量规划

- 每种类型的 Widget Controller **仅应存在一个实例**：
  1. **OverlayWidgetController**（主界面控制）
  2. **AttributeMenuWidgetController**（属性菜单控制）

## 8.2 管理方式

- 由 AuraHUD 统一构造与持有。
- 通过蓝图函数库暴露访问入口。

------

# 9. 本节总结

1. 新建 `AttributeMenuWidgetController` 类，继承自基础类 `AuraWidgetController`。
2. 重写核心函数：
   - `BindCallbacksToDependencies()`
   - `BroadcastInitialValues()`
3. 计划在 AuraHUD 中构建与管理该控制器。
4. 通过 Blueprint Function Library 提供便捷访问接口。
5. 整体保持单例控制模式，每种控制器仅保留一个实例。

