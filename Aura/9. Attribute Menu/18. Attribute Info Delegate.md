## ğŸ¯ Attribute Menu Widget Controller â€” å¹¿æ’­åˆå§‹å€¼ä¸ç»‘å®šæµç¨‹

### ä¸€ã€æ•´ä½“ç›®æ ‡

- åœ¨ Attribute Menu Widget Controller ä¸­ï¼š
  - **ç»‘å®šå›è°ƒï¼ˆcallbacksï¼‰åˆ°ä¾èµ–å¯¹è±¡**
  - **å¹¿æ’­åˆå§‹å±æ€§å€¼**ç»™ UI
- ç›®çš„ï¼šè®©å±æ€§èœå•ï¼ˆAttribute Menu Widgetï¼‰æ­£ç¡®æ˜¾ç¤ºå½“å‰è§’è‰²å±æ€§ã€‚

------

### äºŒã€AuraAttributeInfo çš„ç»“æ„ä¸ç”¨é€”

- åœ¨ Data Asset ä¸­å®šä¹‰çš„ `FAuraAttributeInfo`ï¼š
  - åŒ…å«å±æ€§åç§°ã€æè¿°ã€æ•°å€¼ã€‚
  - Widget é€šè¿‡å¹¿æ’­æ¥æ”¶æ­¤ç»“æ„ä½“ä»¥æ›´æ–°è‡ªèº«æ˜¾ç¤ºã€‚

------

### ä¸‰ã€è·å–å±æ€§é›†ä¸å±æ€§å€¼

1. æ‰“å¼€ `AttributeMenuWidgetController`

2. è·å– AttributeSetï¼š

   ```cpp
   UAuraAttributeSet* AS = CastChecked<UAuraAttributeSet>(AttributeSet);
   ```

3. ä» AttributeSet è·å–å±æ€§å€¼ï¼ˆä¾‹å¦‚ Strengthï¼‰ï¼š

   ```cpp
   AS->GetStrength();
   ```

------

### å››ã€å®šä¹‰åŠ¨æ€å¤šæ’­ä»£ç†ï¼ˆDelegateï¼‰

- åˆ›å»ºä¸€ä¸ªå¯å¹¿æ’­ `FAuraAttributeInfo` çš„ä»£ç†ï¼š

  ```cpp
  DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam(
      FAttributeInfoSignature, const FAuraAttributeInfo&, Info);
  ```

- æ·»åŠ ä¸ºæˆå‘˜å˜é‡ï¼š

  ```cpp
  UPROPERTY(BlueprintAssignable, Category="GAS|Attributes")
  FAttributeInfoSignature AttributeInfoDelegate;
  ```

- ç”¨äºå¹¿æ’­å±æ€§ä¿¡æ¯ï¼Œè®©å¤šä¸ª Widget ç»‘å®šæ¥æ”¶ã€‚

------

### äº”ã€å‡†å¤‡ Data Asset å¼•ç”¨

- æ·»åŠ æˆå‘˜å˜é‡ï¼š

  ```cpp
  UPROPERTY(EditDefaultsOnly)
  TObjectPtr<UAttributeInfo> AttributeInfo;
  ```

- åœ¨è“å›¾ä¸­è®¾å®šå¼•ç”¨ï¼Œä»¥ä¾¿é€šè¿‡ Tag æŸ¥æ‰¾å¯¹åº”å±æ€§ä¿¡æ¯ã€‚

------

### å…­ã€æŸ¥æ‰¾ä¸å¡«å……å±æ€§ä¿¡æ¯

- åœ¨ C++ ä¸­æŸ¥æ‰¾æ•°æ®ï¼š

  ```cpp
  const FAuraGameplayTags& Tags = FAuraGameplayTags::Get();
  FAuraAttributeInfo Info = AttributeInfo->FindAttributeInfoForTag(Tags.Attributes_Primary_Strength);
  ```

- å°†å®æ—¶å±æ€§å€¼å†™å…¥ï¼š

  ```cpp
  Info.AttributeValue = AS->GetStrength();
  ```

- å¹¿æ’­å‡ºå»ï¼š

  ```cpp
  AttributeInfoDelegate.Broadcast(Info);
  ```

------

### ä¸ƒã€åœ¨è“å›¾ä¸­ç»‘å®šä¸å“åº” Delegate

1. WidgetController Blueprintï¼š
   - è®¾ç½® AttributeInfo æ•°æ®èµ„äº§å¼•ç”¨ã€‚
2. Widgetï¼ˆä¾‹å¦‚ TextValueButtonRowï¼‰ï¼š
   - åœ¨ **Event Construct** ä¸­ï¼š
     - è°ƒç”¨ `GetAttributeMenuWidgetController`
     - æ‰§è¡Œ `Assign AttributeInfo Delegate`
     - æ‹†åˆ†ï¼ˆBreakï¼‰Info å¹¶è¯»å–å†…å®¹ã€‚
3. æš‚æ—¶ä»…æ‰“å°å±æ€§åå’Œæ•°å€¼è¿›è¡ŒéªŒè¯ã€‚

------

### å…«ã€çˆ¶ç±» TextValueRow çš„å°è£…

- çˆ¶ç±» `TextValueRow` ä¸­ï¼š

  - æä¾› `TextBlock_Label`ï¼ˆå±æ€§åï¼‰å’Œæ•°å€¼æ˜¾ç¤ºç»„ä»¶ã€‚

  - æ–°å¢å‡½æ•°ï¼š

    ```cpp
    void SetLabelText(FText LabelText)
    ```

- å­ç±» `TextValueButtonRow` è°ƒç”¨ï¼š

  ```cpp
  SetLabelText(Info.AttributeName);
  ```

------

### ä¹ã€è“å›¾è¿æ¥ä¸è¿è¡Œ

1. åœ¨ Widget Controller Blueprintï¼š
   - è®¾å®š Attribute Info å¼•ç”¨ã€‚
2. åœ¨ Attribute Menu Widgetï¼š
   - ç»‘å®š Delegateã€‚
   - ç¡®ä¿åœ¨å¹¿æ’­å‰å®Œæˆç»‘å®šã€‚
3. ä¿®æ”¹ `BroadcastInitialValues()`ï¼š
   - ä½¿å…¶ BlueprintCallableã€‚
   - åœ¨ Widget Controller è®¾ç½®å®Œåè°ƒç”¨ã€‚

------

### åã€è¿è¡Œä¸éªŒè¯

- ç¼–è¯‘å¹¶è¿è¡Œç¼–è¾‘å™¨ï¼š
  - è‹¥å‡ºç° `UAttributeInfo` æœªå£°æ˜é”™è¯¯ â†’ æ·»åŠ  forward declareã€‚
  - å¯åŠ¨è°ƒè¯•æ¨¡å¼ï¼Œæ£€æŸ¥ Delegate æ˜¯å¦æˆåŠŸå¹¿æ’­ã€‚
  - ç¡®è®¤å„ Widget èƒ½æ¥æ”¶åˆ°æ­£ç¡®çš„å±æ€§ä¿¡æ¯å¹¶æ›´æ–°æ–‡æœ¬ã€‚

------

### ğŸ§© æ€»ç»“

æœ¬èŠ‚å®ç°äº†ï¼š

- **C++ â†’ Blueprint â†’ UI** çš„å±æ€§æ•°æ®ä¼ é€’ã€‚
- ä½¿ç”¨ **Delegate å¹¿æ’­æœºåˆ¶** é€šçŸ¥ UIã€‚
- Blueprint ä¸­ **è‡ªåŠ¨ç»‘å®šå’Œæ˜¾ç¤ºå±æ€§å/æ•°å€¼** çš„åŸºç¡€æ¡†æ¶ã€‚

ä¸‹èŠ‚å†…å®¹å°†ç»§ç»­å®Œå–„ï¼š

- æ¯ä¸ªå±æ€§è¡Œç»‘å®šå¯¹åº”çš„ GameplayTagã€‚
- å½“å±æ€§å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–° UI æ˜¾ç¤ºã€‚

