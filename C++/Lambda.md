ä»¥ä¸‹æ˜¯å¯¹ C++ Lambda è¡¨è¾¾å¼çš„å…¨é¢è§£æï¼Œæ¶µç›–æ ¸å¿ƒæ¦‚å¿µã€è¯­æ³•æ¼”è¿›åŠå®æˆ˜ç”¨æ³•ï¼Œç»“åˆ C++11/14/17 æ ‡å‡†è¿›è¡Œè¯´æ˜ï¼š

------

### ğŸ§  **ä¸€ã€Lambda çš„æœ¬è´¨ä¸æ ¸å¿ƒç»“æ„**

Lambda æ˜¯ C++11 å¼•å…¥çš„**åŒ¿åå‡½æ•°å¯¹è±¡**ï¼Œç¼–è¯‘å™¨ä¼šä¸ºå…¶ç”Ÿæˆå”¯ä¸€çš„é—­åŒ…ç±»å‹ï¼ˆClosure Typeï¼‰ã€‚å…¶å®Œæ•´è¯­æ³•ä¸ºï¼š

```
[capture-list] (params) mutable? constexpr? noexcept? -> return-type { body }  
```

- **æ•è·åˆ—è¡¨ï¼ˆCapture Listï¼‰**ï¼šå®šä¹‰å¤–éƒ¨å˜é‡çš„è®¿é—®æ–¹å¼ï¼ˆæ ¸å¿ƒç‰¹æ€§ï¼‰
- **å‚æ•°åˆ—è¡¨ï¼ˆParamsï¼‰**ï¼šä¸æ™®é€šå‡½æ•°å‚æ•°ä¸€è‡´ï¼Œå¯ä¸ºç©º
- **å¯å˜æ€§ï¼ˆmutableï¼‰**ï¼šå…è®¸ä¿®æ”¹æŒ‰å€¼æ•è·çš„å‰¯æœ¬ï¼ˆé»˜è®¤ constï¼‰
- **è¿”å›ç±»å‹**ï¼šå¯çœç•¥ï¼ˆç”± `return` è¯­å¥è‡ªåŠ¨æ¨å¯¼ï¼‰
- **å‡½æ•°ä½“**ï¼šåŒ…å«å®é™…é€»è¾‘ï¼Œå¯ä½¿ç”¨æ•è·å˜é‡å’Œå‚æ•°

> ç¤ºä¾‹ï¼š`auto sum = [](int a, int b) { return a + b; };`

------

### âš™ï¸ **äºŒã€æ•è·åˆ—è¡¨è¯¦è§£ï¼ˆæ ¸å¿ƒæœºåˆ¶ï¼‰**

æ•è·æ–¹å¼å†³å®šå¤–éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸ä¿®æ”¹æƒé™ï¼š

| **æ•è·å½¢å¼**      | **æ•ˆæœ**                                           | **ç¤ºä¾‹**                    |
| ----------------- | -------------------------------------------------- | --------------------------- |
| `[]`              | ä¸æ•è·ä»»ä½•å¤–éƒ¨å˜é‡                                 | `[] { return 42; }`         |
| `[=]`             | éšå¼æŒ‰å€¼æ•è·æ‰€æœ‰**ä½¿ç”¨åˆ°**çš„å¤–éƒ¨å˜é‡ï¼ˆå‰¯æœ¬ç‹¬ç«‹ï¼‰   | `[=] { return x + y; }`     |
| `[&]`             | éšå¼æŒ‰å¼•ç”¨æ•è·æ‰€æœ‰**ä½¿ç”¨åˆ°**çš„å¤–éƒ¨å˜é‡ï¼ˆå½±å“åŸå€¼ï¼‰ | `[&] { x++; }`              |
| `[x, &y]`         | æ˜¾å¼æŒ‡å®šï¼š`x` æŒ‰å€¼æ•è·ï¼Œ`y` æŒ‰å¼•ç”¨æ•è·             | `[x, &y] { y = x * 2; }`    |
| `[=, &z]`         | é»˜è®¤æŒ‰å€¼æ•è·ï¼Œä½† `z` æ˜¾å¼æŒ‰å¼•ç”¨æ•è·                | `[=, &z] { z = x + y; }`    |
| `[this]`          | æ•è·å½“å‰å¯¹è±¡çš„ `this` æŒ‡é’ˆï¼ˆå¯è®¿é—®æˆå‘˜å˜é‡/å‡½æ•°ï¼‰  | `[this] { return size(); }` |
| `[*this]` (C++17) | æŒ‰å€¼æ•è·å½“å‰å¯¹è±¡ï¼ˆé¿å…æ‚¬ç©º `this`ï¼‰                | `[*this] { return id; }`    |
| `[k=42]` (C++14)  | åˆå§‹åŒ–æ•è·ï¼šå®šä¹‰ä»… Lambda å†…éƒ¨å¯ç”¨çš„æ–°å˜é‡         | `[k=value] { return k; }`   |

#### **å…³é”®ç‰¹æ€§**ï¼š

1. 

   æŒ‰å€¼æ•è·çš„å˜é‡é»˜è®¤ä¸å¯ä¿®æ”¹

   ï¼Œéœ€æ·»åŠ  

   ```
   mutable
   ```

    è§£é™¤é™åˆ¶ï¼ˆä¸å½±å“å¤–éƒ¨å˜é‡ï¼‰ï¼š

   ```
   int x = 10;  
   auto f = [x]() mutable { x++; }; // ä¿®æ”¹å†…éƒ¨å‰¯æœ¬  
   ```

2. **æŒ‰å¼•ç”¨æ•è·éœ€æ³¨æ„ç”Ÿå‘½å‘¨æœŸ**ï¼šç¡®ä¿è¢«å¼•ç”¨çš„å˜é‡åœ¨ Lambda è°ƒç”¨æ—¶æœªé”€æ¯

3. **éšå¼æ•è·ä»…æ•è·å®é™…ä½¿ç”¨çš„å˜é‡**ï¼Œéæ•´ä¸ªä½œç”¨åŸŸ

------

### ğŸš€ **ä¸‰ã€C++14/17 å¢å¼ºç‰¹æ€§**

1. **æ³›å‹ Lambdaï¼ˆC++14ï¼‰**ï¼š
    å‚æ•°æ”¯æŒ `auto`ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆæ¨¡æ¿åŒ–çš„ `operator()`ï¼š

   ```
   auto print = [](const auto& v) { std::cout << v; };  
   print(42);    // int  
   print("Hi");  // const char*  
   ```

   ç­‰ä»·äºï¼š

   ```
   struct Anonymous {  
       template <typename T>  
       void operator()(const T& v) const { /*...*/ }  
   };  
   ```

2. **åˆå§‹åŒ–æ•è·ï¼ˆC++14ï¼‰**ï¼š
    æ”¯æŒåœ¨æ•è·åˆ—è¡¨ä¸­å®šä¹‰å¹¶åˆå§‹åŒ–æ–°å˜é‡ï¼ˆå¦‚ç§»åŠ¨è¯­ä¹‰æ•è·ï¼‰ï¼š

   ```
   auto ptr = std::make_unique<int>(10);  
   auto lambda = [p = std::move(ptr)] { return *p; }; // ç§»åŠ¨æ•è·èµ„æº  
   ```

3. **constexpr Lambdaï¼ˆC++17ï¼‰**ï¼š
    å¯åœ¨ç¼–è¯‘æœŸæ±‚å€¼ï¼Œé€‚ç”¨äºå…ƒç¼–ç¨‹åœºæ™¯ï¼š

   ```
   constexpr auto square = [](int n) { return n * n; };  
   static_assert(square(4) == 16);  
   ```

------

### ğŸ› ï¸ **å››ã€å…¸å‹åº”ç”¨åœºæ™¯**

1. **STL ç®—æ³•å›è°ƒ**ï¼ˆç®€åŒ–æ’åº/è¿‡æ»¤é€»è¾‘ï¼‰ï¼š

   ```
   std::vector<int> vec{3, 1, 4, 1, 5};  
   // é™åºæ’åº  
   std::sort(vec.begin(), vec.end(), [](int a, int b) { return a > b; });  
   // è¿‡æ»¤å¶æ•°  
   auto even = std::find_if(vec.begin(), vec.end(), [](int x) { return x % 2 == 0; });  
   ```

2. **å¤šçº¿ç¨‹ä»»åŠ¡å°è£…**ï¼š

   ```
   std::thread t([data = std::move(localData)] {  
       process(data); // å®‰å…¨ä½¿ç”¨ç§»åŠ¨æ•è·çš„æ•°æ®  
   });  
   t.join();  
   ```

3. **å»¶è¿Ÿæ‰§è¡Œä¸å›è°ƒå‡½æ•°**ï¼š

   ```
   void onButtonClick(std::function<void()> callback) {  
       // äº‹ä»¶è§¦å‘æ—¶è°ƒç”¨  
       callback();  
   }  
   // ä¼ é€’ Lambda ä½œä¸ºå›è°ƒ  
   onButtonClick([] { std::cout << "Clicked!"; });  
   ```

4. **ç®€åŒ–æˆå‘˜å‡½æ•°è®¿é—®**ï¼ˆé€šè¿‡ `this` æ•è·ï¼‰ï¼š

   ```
   class Widget {  
       int value = 0;  
   public:  
       auto getIncrementor() {  
           return [this] { value++; }; // æ•è· this ä¿®æ”¹æˆå‘˜  
       }  
   };  
   ```

------

### âš ï¸ **äº”ã€é™·é˜±ä¸æœ€ä½³å®è·µ**

1. **æ‚¬ç©ºå¼•ç”¨é£é™©**ï¼š
    é¿å…è¿”å›æŒ‰å¼•ç”¨æ•è·å±€éƒ¨å˜é‡çš„ Lambdaï¼ˆå±€éƒ¨å˜é‡é”€æ¯åå¼•ç”¨æ— æ•ˆï¼‰ï¼š

   ```
   std::function<void()> createDangerous() {  
       int local = 42;  
       return [&local] { std::cout << local; }; // é”™è¯¯ï¼local å°†é”€æ¯  
   }  
   ```

2. **ä¼˜å…ˆæ˜¾å¼æ•è·**ï¼š
    é¿å…éšå¼æ•è·ï¼ˆ`[=]`/`[&]`ï¼‰ï¼Œæ˜ç¡®åˆ—å‡ºæ‰€éœ€å˜é‡å¢å¼ºå¯è¯»æ€§ï¼š

   ```
   // ä¸æ¨è  
   [&] { use(x, y); }  
   // æ¨è  
   [&x, &y] { use(x, y); }  
   ```

3. **å¤§å¯¹è±¡æ•è·ä¼˜åŒ–**ï¼š
    å¯¹äºå¤åˆ¶æˆæœ¬é«˜çš„å¯¹è±¡ï¼Œä½¿ç”¨ç§»åŠ¨æ•è·ï¼ˆC++14ï¼‰æˆ–æ™ºèƒ½æŒ‡é’ˆï¼š

   ```
   auto bigData = std::make_shared<HugeObject>();  
   auto processor = [data = std::move(bigData)] { /*...*/ };  
   ```

4. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼š
    è·¨çº¿ç¨‹/å¼‚æ­¥åœºæ™¯ä¸­ï¼Œä¼˜å…ˆæŒ‰å€¼æ•è·æˆ–ä½¿ç”¨ `shared_ptr` ç®¡ç†èµ„æºï¼š

   ```
   auto task = [captured = std::make_shared<Resource>(res)] {  
       captured->doWork(); // å®‰å…¨å…±äº«èµ„æº  
   };  
   ```

------

### ğŸ’ **æ€»ç»“**

C++ Lambda é€šè¿‡**é—­åŒ…æœºåˆ¶**å°†ä»£ç é€»è¾‘ä¸ä¸Šä¸‹æ–‡ç»‘å®šï¼Œå…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š

1. **å°±åœ°å°è£…é€»è¾‘**ï¼šé¿å…å®šä¹‰å†—ä½™çš„å‘½åå‡½æ•°æˆ–å‡½æ•°å¯¹è±¡ç±»ã€‚
2. **çµæ´»æ•è·ä¸Šä¸‹æ–‡**ï¼šæŒ‰éœ€è®¿é—®å¤–éƒ¨çŠ¶æ€ï¼ˆå€¼/å¼•ç”¨/ç§»åŠ¨ï¼‰ã€‚
3. **ä¸ç°ä»£ C++ ç‰¹æ€§æ·±åº¦é›†æˆ**ï¼šæ³›å‹ï¼ˆ`auto` å‚æ•°ï¼‰ã€ç¼–è¯‘æœŸè®¡ç®—ï¼ˆ`constexpr`ï¼‰ã€èµ„æºç®¡ç†ï¼ˆç§»åŠ¨è¯­ä¹‰ï¼‰ã€‚
    æŒæ¡ Lambda èƒ½æ˜¾è‘—æå‡ä»£ç è¡¨è¾¾åŠ›ï¼Œå°¤å…¶åœ¨ STL ç®—æ³•ã€å¼‚æ­¥ç¼–ç¨‹å’Œäº‹ä»¶å¤„ç†ä¸­ä¸å¯æˆ–ç¼ºã€‚